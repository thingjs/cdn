{"version":3,"file":"thingjs-agent-0.2.1-withasync.min.js","sources":["async-0.9.0.js","thingjs-agent-0.2.1/bootstrap.js","thingjs-agent-0.2.1/core.js","thingjs-agent-0.2.1/Object.js","thingjs-agent-0.2.1/Base.js","thingjs-agent-0.2.1/Definition.js","thingjs-agent-0.2.1/Delegate.js","thingjs-agent-0.2.1/Pattern.js","thingjs-agent-0.2.1/Agent.js","thingjs-agent-0.2.1/Behaviour.js","thingjs-agent-0.2.1/Selector.js","thingjs-agent-0.2.1/Container.js","thingjs-agent-0.2.1/Tasker.js","thingjs-agent-0.2.1/Heartbeat.js","thingjs-agent-0.2.1/Flow.js","thingjs-agent-0.2.1/Series.js","thingjs-agent-0.2.1/Parallel.js","thingjs-agent-0.2.1/Queue.js","thingjs-agent-0.2.1/Waker.js","thingjs-agent-0.2.1/Util.js"],"names":["only_once","fn","called","Error","apply","root","arguments","previous_async","async","this","noConflict","_toString","Object","prototype","toString","_isArray","Array","isArray","obj","call","_each","arr","iterator","forEach","i","length","_map","map","results","x","a","push","_reduce","memo","reduce","_keys","keys","k","hasOwnProperty","process","nextTick","setImmediate","setTimeout","each","callback","done","err","completed","eachSeries","iterate","forEachSeries","eachLimit","limit","_eachLimit","forEachLimit","started","running","replenish","doParallel","args","slice","concat","doParallelLimit","doSeries","_asyncMap","eachfn","index","value","v","mapSeries","mapLimit","_mapLimit","inject","foldl","reduceRight","reversed","reverse","foldr","_filter","sort","b","filter","filterSeries","select","selectSeries","_reject","reject","rejectSeries","_detect","main_callback","result","detect","detectSeries","some","any","every","all","sortBy","criteria","left","right","auto","tasks","remainingTasks","listeners","addListener","unshift","removeListener","splice","taskComplete","theCallback","task","taskCallback","safeResults","rkey","requires","Math","abs","ready","listener","retry","times","DEFAULT_TIMES","attempts","parseInt","wrappedTask","wrappedCallback","wrappedResults","retryAttempt","finalAttempt","seriesCallback","series","data","waterfall","wrapIterator","next","_parallel","parallel","parallelLimit","makeCallback","_concat","r","cb","y","concatSeries","whilst","test","doWhilst","until","doUntil","queue","worker","concurrency","_insert","q","pos","drain","item","saturated","undefined","workers","empty","paused","kill","shift","idle","pause","resume","priorityQueue","_compareTasks","priority","_binarySearch","sequence","compare","beg","end","mid","cargo","payload","working","drained","ts","ds","_console_fn","name","console","error","log","dir","memoize","hasher","queues","memoized","pop","key","l","unmemoized","unmemoize","count","counter","timesSeries","seq","fns","that","newargs","nextargs","compose","_applyEach","go","applyEach","applyEachSeries","forever","module","exports","define","amd","$thing","bootstrap","usePaho","getMicroTime","Date","now","getBacktrace","first","e","trace","stack","replace","match","createBuffer","byteArray","buf","String","fromCharCode","Uint16Array","Mash","n","mash","charCodeAt","h","create64BitId","h1","h2","split","merge","containers","source","heap","$container","getContainer","backtrace","indexOf","attach","def","_id","_refCount","search","searchMeta","predicate","type","meta","getMeta","_meta","isNaN","toLowerCase","cbBuilder","self","cbDone","agent","cbObj","Container","selector","pattern","selects","callChain","refCount","Tasker","thread","Pattern","Selector","getInterfaces","Definition","Agent","refObject","cbRelease","filters","callArgs","dispatch","method","release","Filter","ALL","FIRST","last","LAST","switchContext","functString","parentOrdinal","superOrdinal","ordinal","superName","methodName","$vtable","ret","$parent","$super","switchParentContext","getName","$inherit","inherit","parent","init","j","signature","signatures","constructor","substring","$owner","$signatures","Base","property","prop","cbGetter","cbSetter","get","set","defineProperty","bind","funct","State","EXPR_AND","EXPR_NOT","EXPR_OR","DEF_DESC","DEF_NAME","DEF_SOURCE","DEF_EXTENDS","DEF_IMPLEMENTS","DEF_USES","DEF_META","DEF_NOP","DEF_END","LIFE_INITIATED","LIFE_ACTIVE","LIFE_WAITING","LIFE_SUSPENDED","LIFE_DELETED","LIFE_TRANSIT","LIFE_BLOCKED","_metaHandlers","mobile","_isMobile","passive","_isPassive","singleton","_singleton","_source","catchall","_substitute","$__catchall__","container","_super","_state","_parent","_children","_interfaces","_uses","_isAgent","_isAbstract","$id","$source","parseStack","_extends","_name","_class","_instance","_childrenWrapper","_pushChild","_forEachChild","_countChildren","_factory","interfaces","getHeapId","id","child","getRefCount","charAt","Boolean","RegExp","patchObject","getSource","getChildren","getState","setState","states","state","unsetState","isAbstract","unpatchObject","constructed","setup","takedown","Delegate","matchInterface","_pattern","toArray","doActivate","doDelete","doSuspend","doWait","doWake","addBehaviour","reset","Behaviour","instance","removeBehaviour","objs","children","action","$cb","block","restart","includePassive","include","_exprs","_selection","_callbacks","_backtrace","expr","and","not","isPassive","matchObject","m","cbItem","interface","cbNext","nextWakeTime","WAKE_MIN_PERIOD","doAction","isActionTaskQueued","keepAlive","intervalId","setInterval","destroy","clearInterval","getFlow","methods","names","cbYield","yield","getQueue","functs","active","flow","items","errs","getWakeTime","time","period","wake","stop","catchAll"],"mappings":"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","sourcesContent":["/*!\n * async\n * https://github.com/caolan/async\n *\n * Copyright 2010-2014 Caolan McMahon\n * Released under the MIT license\n */\n/*jshint onevar: false, indent:4 */\n/*global setImmediate: false, setTimeout: false, console: false */\n(function () {\n\n    var async = {};\n\n    // global on the server, window in the browser\n    var root, previous_async;\n\n    root = this;\n    if (root != null) {\n      previous_async = root.async;\n    }\n\n    async.noConflict = function () {\n        root.async = previous_async;\n        return async;\n    };\n\n    function only_once(fn) {\n        var called = false;\n        return function() {\n            if (called) throw new Error(\"Callback was already called.\");\n            called = true;\n            fn.apply(root, arguments);\n        }\n    }\n\n    //// cross-browser compatiblity functions ////\n\n    var _toString = Object.prototype.toString;\n\n    var _isArray = Array.isArray || function (obj) {\n        return _toString.call(obj) === '[object Array]';\n    };\n\n    var _each = function (arr, iterator) {\n        if (arr.forEach) {\n            return arr.forEach(iterator);\n        }\n        for (var i = 0; i < arr.length; i += 1) {\n            iterator(arr[i], i, arr);\n        }\n    };\n\n    var _map = function (arr, iterator) {\n        if (arr.map) {\n            return arr.map(iterator);\n        }\n        var results = [];\n        _each(arr, function (x, i, a) {\n            results.push(iterator(x, i, a));\n        });\n        return results;\n    };\n\n    var _reduce = function (arr, iterator, memo) {\n        if (arr.reduce) {\n            return arr.reduce(iterator, memo);\n        }\n        _each(arr, function (x, i, a) {\n            memo = iterator(memo, x, i, a);\n        });\n        return memo;\n    };\n\n    var _keys = function (obj) {\n        if (Object.keys) {\n            return Object.keys(obj);\n        }\n        var keys = [];\n        for (var k in obj) {\n            if (obj.hasOwnProperty(k)) {\n                keys.push(k);\n            }\n        }\n        return keys;\n    };\n\n    //// exported async module functions ////\n\n    //// nextTick implementation with browser-compatible fallback ////\n    if (typeof process === 'undefined' || !(process.nextTick)) {\n        if (typeof setImmediate === 'function') {\n            async.nextTick = function (fn) {\n                // not a direct alias for IE10 compatibility\n                setImmediate(fn);\n            };\n            async.setImmediate = async.nextTick;\n        }\n        else {\n            async.nextTick = function (fn) {\n                setTimeout(fn, 0);\n            };\n            async.setImmediate = async.nextTick;\n        }\n    }\n    else {\n        async.nextTick = process.nextTick;\n        if (typeof setImmediate !== 'undefined') {\n            async.setImmediate = function (fn) {\n              // not a direct alias for IE10 compatibility\n              setImmediate(fn);\n            };\n        }\n        else {\n            async.setImmediate = async.nextTick;\n        }\n    }\n\n    async.each = function (arr, iterator, callback) {\n        callback = callback || function () {};\n        if (!arr.length) {\n            return callback();\n        }\n        var completed = 0;\n        _each(arr, function (x) {\n            iterator(x, only_once(done) );\n        });\n        function done(err) {\n          if (err) {\n              callback(err);\n              callback = function () {};\n          }\n          else {\n              completed += 1;\n              if (completed >= arr.length) {\n                  callback();\n              }\n          }\n        }\n    };\n    async.forEach = async.each;\n\n    async.eachSeries = function (arr, iterator, callback) {\n        callback = callback || function () {};\n        if (!arr.length) {\n            return callback();\n        }\n        var completed = 0;\n        var iterate = function () {\n            iterator(arr[completed], function (err) {\n                if (err) {\n                    callback(err);\n                    callback = function () {};\n                }\n                else {\n                    completed += 1;\n                    if (completed >= arr.length) {\n                        callback();\n                    }\n                    else {\n                        iterate();\n                    }\n                }\n            });\n        };\n        iterate();\n    };\n    async.forEachSeries = async.eachSeries;\n\n    async.eachLimit = function (arr, limit, iterator, callback) {\n        var fn = _eachLimit(limit);\n        fn.apply(null, [arr, iterator, callback]);\n    };\n    async.forEachLimit = async.eachLimit;\n\n    var _eachLimit = function (limit) {\n\n        return function (arr, iterator, callback) {\n            callback = callback || function () {};\n            if (!arr.length || limit <= 0) {\n                return callback();\n            }\n            var completed = 0;\n            var started = 0;\n            var running = 0;\n\n            (function replenish () {\n                if (completed >= arr.length) {\n                    return callback();\n                }\n\n                while (running < limit && started < arr.length) {\n                    started += 1;\n                    running += 1;\n                    iterator(arr[started - 1], function (err) {\n                        if (err) {\n                            callback(err);\n                            callback = function () {};\n                        }\n                        else {\n                            completed += 1;\n                            running -= 1;\n                            if (completed >= arr.length) {\n                                callback();\n                            }\n                            else {\n                                replenish();\n                            }\n                        }\n                    });\n                }\n            })();\n        };\n    };\n\n\n    var doParallel = function (fn) {\n        return function () {\n            var args = Array.prototype.slice.call(arguments);\n            return fn.apply(null, [async.each].concat(args));\n        };\n    };\n    var doParallelLimit = function(limit, fn) {\n        return function () {\n            var args = Array.prototype.slice.call(arguments);\n            return fn.apply(null, [_eachLimit(limit)].concat(args));\n        };\n    };\n    var doSeries = function (fn) {\n        return function () {\n            var args = Array.prototype.slice.call(arguments);\n            return fn.apply(null, [async.eachSeries].concat(args));\n        };\n    };\n\n\n    var _asyncMap = function (eachfn, arr, iterator, callback) {\n        arr = _map(arr, function (x, i) {\n            return {index: i, value: x};\n        });\n        if (!callback) {\n            eachfn(arr, function (x, callback) {\n                iterator(x.value, function (err) {\n                    callback(err);\n                });\n            });\n        } else {\n            var results = [];\n            eachfn(arr, function (x, callback) {\n                iterator(x.value, function (err, v) {\n                    results[x.index] = v;\n                    callback(err);\n                });\n            }, function (err) {\n                callback(err, results);\n            });\n        }\n    };\n    async.map = doParallel(_asyncMap);\n    async.mapSeries = doSeries(_asyncMap);\n    async.mapLimit = function (arr, limit, iterator, callback) {\n        return _mapLimit(limit)(arr, iterator, callback);\n    };\n\n    var _mapLimit = function(limit) {\n        return doParallelLimit(limit, _asyncMap);\n    };\n\n    // reduce only has a series version, as doing reduce in parallel won't\n    // work in many situations.\n    async.reduce = function (arr, memo, iterator, callback) {\n        async.eachSeries(arr, function (x, callback) {\n            iterator(memo, x, function (err, v) {\n                memo = v;\n                callback(err);\n            });\n        }, function (err) {\n            callback(err, memo);\n        });\n    };\n    // inject alias\n    async.inject = async.reduce;\n    // foldl alias\n    async.foldl = async.reduce;\n\n    async.reduceRight = function (arr, memo, iterator, callback) {\n        var reversed = _map(arr, function (x) {\n            return x;\n        }).reverse();\n        async.reduce(reversed, memo, iterator, callback);\n    };\n    // foldr alias\n    async.foldr = async.reduceRight;\n\n    var _filter = function (eachfn, arr, iterator, callback) {\n        var results = [];\n        arr = _map(arr, function (x, i) {\n            return {index: i, value: x};\n        });\n        eachfn(arr, function (x, callback) {\n            iterator(x.value, function (v) {\n                if (v) {\n                    results.push(x);\n                }\n                callback();\n            });\n        }, function (err) {\n            callback(_map(results.sort(function (a, b) {\n                return a.index - b.index;\n            }), function (x) {\n                return x.value;\n            }));\n        });\n    };\n    async.filter = doParallel(_filter);\n    async.filterSeries = doSeries(_filter);\n    // select alias\n    async.select = async.filter;\n    async.selectSeries = async.filterSeries;\n\n    var _reject = function (eachfn, arr, iterator, callback) {\n        var results = [];\n        arr = _map(arr, function (x, i) {\n            return {index: i, value: x};\n        });\n        eachfn(arr, function (x, callback) {\n            iterator(x.value, function (v) {\n                if (!v) {\n                    results.push(x);\n                }\n                callback();\n            });\n        }, function (err) {\n            callback(_map(results.sort(function (a, b) {\n                return a.index - b.index;\n            }), function (x) {\n                return x.value;\n            }));\n        });\n    };\n    async.reject = doParallel(_reject);\n    async.rejectSeries = doSeries(_reject);\n\n    var _detect = function (eachfn, arr, iterator, main_callback) {\n        eachfn(arr, function (x, callback) {\n            iterator(x, function (result) {\n                if (result) {\n                    main_callback(x);\n                    main_callback = function () {};\n                }\n                else {\n                    callback();\n                }\n            });\n        }, function (err) {\n            main_callback();\n        });\n    };\n    async.detect = doParallel(_detect);\n    async.detectSeries = doSeries(_detect);\n\n    async.some = function (arr, iterator, main_callback) {\n        async.each(arr, function (x, callback) {\n            iterator(x, function (v) {\n                if (v) {\n                    main_callback(true);\n                    main_callback = function () {};\n                }\n                callback();\n            });\n        }, function (err) {\n            main_callback(false);\n        });\n    };\n    // any alias\n    async.any = async.some;\n\n    async.every = function (arr, iterator, main_callback) {\n        async.each(arr, function (x, callback) {\n            iterator(x, function (v) {\n                if (!v) {\n                    main_callback(false);\n                    main_callback = function () {};\n                }\n                callback();\n            });\n        }, function (err) {\n            main_callback(true);\n        });\n    };\n    // all alias\n    async.all = async.every;\n\n    async.sortBy = function (arr, iterator, callback) {\n        async.map(arr, function (x, callback) {\n            iterator(x, function (err, criteria) {\n                if (err) {\n                    callback(err);\n                }\n                else {\n                    callback(null, {value: x, criteria: criteria});\n                }\n            });\n        }, function (err, results) {\n            if (err) {\n                return callback(err);\n            }\n            else {\n                var fn = function (left, right) {\n                    var a = left.criteria, b = right.criteria;\n                    return a < b ? -1 : a > b ? 1 : 0;\n                };\n                callback(null, _map(results.sort(fn), function (x) {\n                    return x.value;\n                }));\n            }\n        });\n    };\n\n    async.auto = function (tasks, callback) {\n        callback = callback || function () {};\n        var keys = _keys(tasks);\n        var remainingTasks = keys.length\n        if (!remainingTasks) {\n            return callback();\n        }\n\n        var results = {};\n\n        var listeners = [];\n        var addListener = function (fn) {\n            listeners.unshift(fn);\n        };\n        var removeListener = function (fn) {\n            for (var i = 0; i < listeners.length; i += 1) {\n                if (listeners[i] === fn) {\n                    listeners.splice(i, 1);\n                    return;\n                }\n            }\n        };\n        var taskComplete = function () {\n            remainingTasks--\n            _each(listeners.slice(0), function (fn) {\n                fn();\n            });\n        };\n\n        addListener(function () {\n            if (!remainingTasks) {\n                var theCallback = callback;\n                // prevent final callback from calling itself if it errors\n                callback = function () {};\n\n                theCallback(null, results);\n            }\n        });\n\n        _each(keys, function (k) {\n            var task = _isArray(tasks[k]) ? tasks[k]: [tasks[k]];\n            var taskCallback = function (err) {\n                var args = Array.prototype.slice.call(arguments, 1);\n                if (args.length <= 1) {\n                    args = args[0];\n                }\n                if (err) {\n                    var safeResults = {};\n                    _each(_keys(results), function(rkey) {\n                        safeResults[rkey] = results[rkey];\n                    });\n                    safeResults[k] = args;\n                    callback(err, safeResults);\n                    // stop subsequent errors hitting callback multiple times\n                    callback = function () {};\n                }\n                else {\n                    results[k] = args;\n                    async.setImmediate(taskComplete);\n                }\n            };\n            var requires = task.slice(0, Math.abs(task.length - 1)) || [];\n            var ready = function () {\n                return _reduce(requires, function (a, x) {\n                    return (a && results.hasOwnProperty(x));\n                }, true) && !results.hasOwnProperty(k);\n            };\n            if (ready()) {\n                task[task.length - 1](taskCallback, results);\n            }\n            else {\n                var listener = function () {\n                    if (ready()) {\n                        removeListener(listener);\n                        task[task.length - 1](taskCallback, results);\n                    }\n                };\n                addListener(listener);\n            }\n        });\n    };\n\n    async.retry = function(times, task, callback) {\n        var DEFAULT_TIMES = 5;\n        var attempts = [];\n        // Use defaults if times not passed\n        if (typeof times === 'function') {\n            callback = task;\n            task = times;\n            times = DEFAULT_TIMES;\n        }\n        // Make sure times is a number\n        times = parseInt(times, 10) || DEFAULT_TIMES;\n        var wrappedTask = function(wrappedCallback, wrappedResults) {\n            var retryAttempt = function(task, finalAttempt) {\n                return function(seriesCallback) {\n                    task(function(err, result){\n                        seriesCallback(!err || finalAttempt, {err: err, result: result});\n                    }, wrappedResults);\n                };\n            };\n            while (times) {\n                attempts.push(retryAttempt(task, !(times-=1)));\n            }\n            async.series(attempts, function(done, data){\n                data = data[data.length - 1];\n                (wrappedCallback || callback)(data.err, data.result);\n            });\n        }\n        // If a callback is passed, run this as a controll flow\n        return callback ? wrappedTask() : wrappedTask\n    };\n\n    async.waterfall = function (tasks, callback) {\n        callback = callback || function () {};\n        if (!_isArray(tasks)) {\n          var err = new Error('First argument to waterfall must be an array of functions');\n          return callback(err);\n        }\n        if (!tasks.length) {\n            return callback();\n        }\n        var wrapIterator = function (iterator) {\n            return function (err) {\n                if (err) {\n                    callback.apply(null, arguments);\n                    callback = function () {};\n                }\n                else {\n                    var args = Array.prototype.slice.call(arguments, 1);\n                    var next = iterator.next();\n                    if (next) {\n                        args.push(wrapIterator(next));\n                    }\n                    else {\n                        args.push(callback);\n                    }\n                    async.setImmediate(function () {\n                        iterator.apply(null, args);\n                    });\n                }\n            };\n        };\n        wrapIterator(async.iterator(tasks))();\n    };\n\n    var _parallel = function(eachfn, tasks, callback) {\n        callback = callback || function () {};\n        if (_isArray(tasks)) {\n            eachfn.map(tasks, function (fn, callback) {\n                if (fn) {\n                    fn(function (err) {\n                        var args = Array.prototype.slice.call(arguments, 1);\n                        if (args.length <= 1) {\n                            args = args[0];\n                        }\n                        callback.call(null, err, args);\n                    });\n                }\n            }, callback);\n        }\n        else {\n            var results = {};\n            eachfn.each(_keys(tasks), function (k, callback) {\n                tasks[k](function (err) {\n                    var args = Array.prototype.slice.call(arguments, 1);\n                    if (args.length <= 1) {\n                        args = args[0];\n                    }\n                    results[k] = args;\n                    callback(err);\n                });\n            }, function (err) {\n                callback(err, results);\n            });\n        }\n    };\n\n    async.parallel = function (tasks, callback) {\n        _parallel({ map: async.map, each: async.each }, tasks, callback);\n    };\n\n    async.parallelLimit = function(tasks, limit, callback) {\n        _parallel({ map: _mapLimit(limit), each: _eachLimit(limit) }, tasks, callback);\n    };\n\n    async.series = function (tasks, callback) {\n        callback = callback || function () {};\n        if (_isArray(tasks)) {\n            async.mapSeries(tasks, function (fn, callback) {\n                if (fn) {\n                    fn(function (err) {\n                        var args = Array.prototype.slice.call(arguments, 1);\n                        if (args.length <= 1) {\n                            args = args[0];\n                        }\n                        callback.call(null, err, args);\n                    });\n                }\n            }, callback);\n        }\n        else {\n            var results = {};\n            async.eachSeries(_keys(tasks), function (k, callback) {\n                tasks[k](function (err) {\n                    var args = Array.prototype.slice.call(arguments, 1);\n                    if (args.length <= 1) {\n                        args = args[0];\n                    }\n                    results[k] = args;\n                    callback(err);\n                });\n            }, function (err) {\n                callback(err, results);\n            });\n        }\n    };\n\n    async.iterator = function (tasks) {\n        var makeCallback = function (index) {\n            var fn = function () {\n                if (tasks.length) {\n                    tasks[index].apply(null, arguments);\n                }\n                return fn.next();\n            };\n            fn.next = function () {\n                return (index < tasks.length - 1) ? makeCallback(index + 1): null;\n            };\n            return fn;\n        };\n        return makeCallback(0);\n    };\n\n    async.apply = function (fn) {\n        var args = Array.prototype.slice.call(arguments, 1);\n        return function () {\n            return fn.apply(\n                null, args.concat(Array.prototype.slice.call(arguments))\n            );\n        };\n    };\n\n    var _concat = function (eachfn, arr, fn, callback) {\n        var r = [];\n        eachfn(arr, function (x, cb) {\n            fn(x, function (err, y) {\n                r = r.concat(y || []);\n                cb(err);\n            });\n        }, function (err) {\n            callback(err, r);\n        });\n    };\n    async.concat = doParallel(_concat);\n    async.concatSeries = doSeries(_concat);\n\n    async.whilst = function (test, iterator, callback) {\n        if (test()) {\n            iterator(function (err) {\n                if (err) {\n                    return callback(err);\n                }\n                async.whilst(test, iterator, callback);\n            });\n        }\n        else {\n            callback();\n        }\n    };\n\n    async.doWhilst = function (iterator, test, callback) {\n        iterator(function (err) {\n            if (err) {\n                return callback(err);\n            }\n            var args = Array.prototype.slice.call(arguments, 1);\n            if (test.apply(null, args)) {\n                async.doWhilst(iterator, test, callback);\n            }\n            else {\n                callback();\n            }\n        });\n    };\n\n    async.until = function (test, iterator, callback) {\n        if (!test()) {\n            iterator(function (err) {\n                if (err) {\n                    return callback(err);\n                }\n                async.until(test, iterator, callback);\n            });\n        }\n        else {\n            callback();\n        }\n    };\n\n    async.doUntil = function (iterator, test, callback) {\n        iterator(function (err) {\n            if (err) {\n                return callback(err);\n            }\n            var args = Array.prototype.slice.call(arguments, 1);\n            if (!test.apply(null, args)) {\n                async.doUntil(iterator, test, callback);\n            }\n            else {\n                callback();\n            }\n        });\n    };\n\n    async.queue = function (worker, concurrency) {\n        if (concurrency === undefined) {\n            concurrency = 1;\n        }\n        function _insert(q, data, pos, callback) {\n          if (!q.started){\n            q.started = true;\n          }\n          if (!_isArray(data)) {\n              data = [data];\n          }\n          if(data.length == 0) {\n             // call drain immediately if there are no tasks\n             return async.setImmediate(function() {\n                 if (q.drain) {\n                     q.drain();\n                 }\n             });\n          }\n          _each(data, function(task) {\n              var item = {\n                  data: task,\n                  callback: typeof callback === 'function' ? callback : null\n              };\n\n              if (pos) {\n                q.tasks.unshift(item);\n              } else {\n                q.tasks.push(item);\n              }\n\n              if (q.saturated && q.tasks.length === q.concurrency) {\n                  q.saturated();\n              }\n              async.setImmediate(q.process);\n          });\n        }\n\n        var workers = 0;\n        var q = {\n            tasks: [],\n            concurrency: concurrency,\n            saturated: null,\n            empty: null,\n            drain: null,\n            started: false,\n            paused: false,\n            push: function (data, callback) {\n              _insert(q, data, false, callback);\n            },\n            kill: function () {\n              q.drain = null;\n              q.tasks = [];\n            },\n            unshift: function (data, callback) {\n              _insert(q, data, true, callback);\n            },\n            process: function () {\n                if (!q.paused && workers < q.concurrency && q.tasks.length) {\n                    var task = q.tasks.shift();\n                    if (q.empty && q.tasks.length === 0) {\n                        q.empty();\n                    }\n                    workers += 1;\n                    var next = function () {\n                        workers -= 1;\n                        if (task.callback) {\n                            task.callback.apply(task, arguments);\n                        }\n                        if (q.drain && q.tasks.length + workers === 0) {\n                            q.drain();\n                        }\n                        q.process();\n                    };\n                    var cb = only_once(next);\n                    worker(task.data, cb);\n                }\n            },\n            length: function () {\n                return q.tasks.length;\n            },\n            running: function () {\n                return workers;\n            },\n            idle: function() {\n                return q.tasks.length + workers === 0;\n            },\n            pause: function () {\n                if (q.paused === true) { return; }\n                q.paused = true;\n                q.process();\n            },\n            resume: function () {\n                if (q.paused === false) { return; }\n                q.paused = false;\n                q.process();\n            }\n        };\n        return q;\n    };\n    \n    async.priorityQueue = function (worker, concurrency) {\n        \n        function _compareTasks(a, b){\n          return a.priority - b.priority;\n        };\n        \n        function _binarySearch(sequence, item, compare) {\n          var beg = -1,\n              end = sequence.length - 1;\n          while (beg < end) {\n            var mid = beg + ((end - beg + 1) >>> 1);\n            if (compare(item, sequence[mid]) >= 0) {\n              beg = mid;\n            } else {\n              end = mid - 1;\n            }\n          }\n          return beg;\n        }\n        \n        function _insert(q, data, priority, callback) {\n          if (!q.started){\n            q.started = true;\n          }\n          if (!_isArray(data)) {\n              data = [data];\n          }\n          if(data.length == 0) {\n             // call drain immediately if there are no tasks\n             return async.setImmediate(function() {\n                 if (q.drain) {\n                     q.drain();\n                 }\n             });\n          }\n          _each(data, function(task) {\n              var item = {\n                  data: task,\n                  priority: priority,\n                  callback: typeof callback === 'function' ? callback : null\n              };\n              \n              q.tasks.splice(_binarySearch(q.tasks, item, _compareTasks) + 1, 0, item);\n\n              if (q.saturated && q.tasks.length === q.concurrency) {\n                  q.saturated();\n              }\n              async.setImmediate(q.process);\n          });\n        }\n        \n        // Start with a normal queue\n        var q = async.queue(worker, concurrency);\n        \n        // Override push to accept second parameter representing priority\n        q.push = function (data, priority, callback) {\n          _insert(q, data, priority, callback);\n        };\n        \n        // Remove unshift function\n        delete q.unshift;\n\n        return q;\n    };\n\n    async.cargo = function (worker, payload) {\n        var working     = false,\n            tasks       = [];\n\n        var cargo = {\n            tasks: tasks,\n            payload: payload,\n            saturated: null,\n            empty: null,\n            drain: null,\n            drained: true,\n            push: function (data, callback) {\n                if (!_isArray(data)) {\n                    data = [data];\n                }\n                _each(data, function(task) {\n                    tasks.push({\n                        data: task,\n                        callback: typeof callback === 'function' ? callback : null\n                    });\n                    cargo.drained = false;\n                    if (cargo.saturated && tasks.length === payload) {\n                        cargo.saturated();\n                    }\n                });\n                async.setImmediate(cargo.process);\n            },\n            process: function process() {\n                if (working) return;\n                if (tasks.length === 0) {\n                    if(cargo.drain && !cargo.drained) cargo.drain();\n                    cargo.drained = true;\n                    return;\n                }\n\n                var ts = typeof payload === 'number'\n                            ? tasks.splice(0, payload)\n                            : tasks.splice(0, tasks.length);\n\n                var ds = _map(ts, function (task) {\n                    return task.data;\n                });\n\n                if(cargo.empty) cargo.empty();\n                working = true;\n                worker(ds, function () {\n                    working = false;\n\n                    var args = arguments;\n                    _each(ts, function (data) {\n                        if (data.callback) {\n                            data.callback.apply(null, args);\n                        }\n                    });\n\n                    process();\n                });\n            },\n            length: function () {\n                return tasks.length;\n            },\n            running: function () {\n                return working;\n            }\n        };\n        return cargo;\n    };\n\n    var _console_fn = function (name) {\n        return function (fn) {\n            var args = Array.prototype.slice.call(arguments, 1);\n            fn.apply(null, args.concat([function (err) {\n                var args = Array.prototype.slice.call(arguments, 1);\n                if (typeof console !== 'undefined') {\n                    if (err) {\n                        if (console.error) {\n                            console.error(err);\n                        }\n                    }\n                    else if (console[name]) {\n                        _each(args, function (x) {\n                            console[name](x);\n                        });\n                    }\n                }\n            }]));\n        };\n    };\n    async.log = _console_fn('log');\n    async.dir = _console_fn('dir');\n    /*async.info = _console_fn('info');\n    async.warn = _console_fn('warn');\n    async.error = _console_fn('error');*/\n\n    async.memoize = function (fn, hasher) {\n        var memo = {};\n        var queues = {};\n        hasher = hasher || function (x) {\n            return x;\n        };\n        var memoized = function () {\n            var args = Array.prototype.slice.call(arguments);\n            var callback = args.pop();\n            var key = hasher.apply(null, args);\n            if (key in memo) {\n                async.nextTick(function () {\n                    callback.apply(null, memo[key]);\n                });\n            }\n            else if (key in queues) {\n                queues[key].push(callback);\n            }\n            else {\n                queues[key] = [callback];\n                fn.apply(null, args.concat([function () {\n                    memo[key] = arguments;\n                    var q = queues[key];\n                    delete queues[key];\n                    for (var i = 0, l = q.length; i < l; i++) {\n                      q[i].apply(null, arguments);\n                    }\n                }]));\n            }\n        };\n        memoized.memo = memo;\n        memoized.unmemoized = fn;\n        return memoized;\n    };\n\n    async.unmemoize = function (fn) {\n      return function () {\n        return (fn.unmemoized || fn).apply(null, arguments);\n      };\n    };\n\n    async.times = function (count, iterator, callback) {\n        var counter = [];\n        for (var i = 0; i < count; i++) {\n            counter.push(i);\n        }\n        return async.map(counter, iterator, callback);\n    };\n\n    async.timesSeries = function (count, iterator, callback) {\n        var counter = [];\n        for (var i = 0; i < count; i++) {\n            counter.push(i);\n        }\n        return async.mapSeries(counter, iterator, callback);\n    };\n\n    async.seq = function (/* functions... */) {\n        var fns = arguments;\n        return function () {\n            var that = this;\n            var args = Array.prototype.slice.call(arguments);\n            var callback = args.pop();\n            async.reduce(fns, args, function (newargs, fn, cb) {\n                fn.apply(that, newargs.concat([function () {\n                    var err = arguments[0];\n                    var nextargs = Array.prototype.slice.call(arguments, 1);\n                    cb(err, nextargs);\n                }]))\n            },\n            function (err, results) {\n                callback.apply(that, [err].concat(results));\n            });\n        };\n    };\n\n    async.compose = function (/* functions... */) {\n      return async.seq.apply(null, Array.prototype.reverse.call(arguments));\n    };\n\n    var _applyEach = function (eachfn, fns /*args...*/) {\n        var go = function () {\n            var that = this;\n            var args = Array.prototype.slice.call(arguments);\n            var callback = args.pop();\n            return eachfn(fns, function (fn, cb) {\n                fn.apply(that, args.concat([cb]));\n            },\n            callback);\n        };\n        if (arguments.length > 2) {\n            var args = Array.prototype.slice.call(arguments, 2);\n            return go.apply(this, args);\n        }\n        else {\n            return go;\n        }\n    };\n    async.applyEach = doParallel(_applyEach);\n    async.applyEachSeries = doSeries(_applyEach);\n\n    async.forever = function (fn, callback) {\n        function next(err) {\n            if (err) {\n                if (callback) {\n                    return callback(err);\n                }\n                throw err;\n            }\n            fn(next);\n        }\n        next();\n    };\n\n    // Node.js\n    if (typeof module !== 'undefined' && module.exports) {\n        module.exports = async;\n    }\n    // AMD / RequireJS\n    else if (typeof define !== 'undefined' && define.amd) {\n        define([], function () {\n            return async;\n        });\n    }\n    // included directly via <script> tag\n    else {\n        root.async = async;\n    }\n\n}());\n","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n\nvar $thing = $thing || {};\n\n$thing.bootstrap = 'browser.js';\n$thing.usePaho = true;\n\n$thing.async = async;\n\n$thing.getMicroTime = function() {\n    return Date.now() * 1000;\n};\n\n$thing.getBacktrace = function(first) {\n    first = first || 0;\n\n    try {\n        0(); \n    }\n    catch(e) {\n        var trace = e.stack\n                .replace(/Object\\.\\$thing\\.\\$container [^\\r\\n\\t\\f ]+/g, '$container:0:0')\n                .replace(/\\$thing\\.\\$container@[^\\r\\n\\t\\f ]+/g, '$container:0:0')\n                .replace(/\\$container@[^\\r\\n\\t\\f ]+/g, '$container:0:0')\n            ;\n\n        if ((trace = trace.match(/[^\\r\\n\\t\\f\\( ]+\\d\\:\\d+/g)) !== null)\n            return trace.slice(1 + first);\n        else if ((trace = trace.match(/\\s+at /g)) !== null)\n            return trace.slice(1 + first);\n        return [];\n    }\n};\n\n$thing.createBuffer = function(byteArray) {\n    return {\n        buf: byteArray,\n        toString: function() {\n            return String.fromCharCode.apply(\n                null, \n                new Uint16Array(byteArray)\n            );\n        }\n    };\n};","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n\n/** @namespace $thing */\n\n$thing.Mash = function() {\n    // Mash by Johannes Baagoe <baagoe@baagoe.com>\n    var n = 0xefc8249d;\n    var mash = function(data) {\n        data = data.toString();\n        for (var i = 0; i < data.length; i++) {\n            n += data.charCodeAt(i);\n            var h = 0.02519603282416938 * n;\n            n = h >>> 0;\n            h -= n;\n            h *= n;\n            n = h >>> 0;\n            h -= n;\n            n += h * 0x100000000; \n        }\n        return (n >>> 0) * 2.3283064365386963e-10; \n    };\n    return mash;\n};\n\n/**\n * @memberOf $thing\n * @method create64BitId\n */\n$thing.create64BitId = function() {\n    var h1 = new $thing.Mash(),\n        h2 = new $thing.Mash()\n        ;\n\n    for (var i = 0; i < arguments.length; i++) \n        h1(arguments[i] || '');\n\n    return  h1('').toString(16).split('.')[1] +\n            h2($thing.getMicroTime()).toString(16).split('.')[1]\n            ;\n};\n\n/**\n * @memberOf $thing\n * @method merge\n */\n$thing.merge = function() {\n    var args = Array.prototype.slice.call(arguments, 0),\n        obj = args[0],\n        i = 1\n        ;\n        \n    for(; i < args.length; i++)\n        if (args[i] !== undefined)\n            for(var k in args[i])\n                (obj[k] === undefined)\n                    ? obj[k] = args[i][k]\n                    : undefined\n                    ;\n\n    return obj;\n};\n\n$thing.containers = {\n    $thing: {\n        source: '$thing',\n        heap: []\n    }    \n};\n\n/**\n * @memberOf $thing\n * @method container\n */\n$thing.$container = function(cb) {\n    cb();\n};\n\n/**\n * @memberOf $thing\n * @method getContainer\n */\n$thing.getContainer = function(backtrace) {\n    var i = backtrace.indexOf('$container:0:0');\n\n    if (i === -1)\n        return $thing.containers.$thing;\n    else \n        return $thing.containers[backtrace[++i]] \n            ? $thing.containers[backtrace[i]]\n            : $thing.containers[backtrace[i]] = { \n                source: backtrace[i],\n                heap: [] \n            }\n            ;\n};\n\n/**\n * @memberOf $thing\n * @method attach\n */\n$thing.attach = function(def, heap) {\n\n    if (def._id !== undefined) \n        return def._id;\n    else {\n        var length = heap.length;\n        \n        while(heap.length !== 0 &&\n            heap[heap.length - 1]._refCount === 0\n        ) \n            (heap.pop())._id = undefined;\n        \n        if (!heap.length || heap.length !== length)\n            def._id = heap.push(def) - 1;\n        else {\n            def._id = undefined;\n            \n            for(var i = heap.length - 1;\n                i > -1 && def._id === undefined;\n                i--\n            )\n                if (heap[i]._refCount === 0) {\n                    heap[i]._id = undefined;\n                    heap[def._id = i] = def;\n                }\n            \n            if (def._id === undefined)\n                def._id = heap.push(def) - 1;\n        }\n        \n        return def._id;\n    }\n};\n\n/**\n * @memberOf $thing\n * @method search\n */\n$thing.search = function(obj, heap) {\n    var match;\n    \n    for(var i = heap.length - 1; i > -1; i--) {\n        if (heap[i]._refCount > 0) {\n            for(var k in obj)\n                if (!(match = obj[k] === heap[i][k]))\n                    break;\n                \n                if (match)\n                    return heap[i];\n            }\n        }\n    \n    return undefined;\n};\n\n/**\n * @memberOf $thing\n * @method searchMeta\n */\n$thing.searchMeta = function(obj, predicate) {\n    var type = 'string',\n        cb = arguments[2],\n        meta = (obj.getMeta !== undefined)\n            ? obj.getMeta()\n            : obj._meta\n        ;\n    \n    switch(arguments[2]) {\n        case 'int':\n        case 'boolean':\n        case 'string':\n            type = arguments[2];\n            cb = arguments[3];\n    }\n    \n    meta.forEach(function(item) {\n        item = item.match(/\\S+/g);\n        if (item !== null && item[0] === predicate) {\n            item = item.slice(1);\n            \n            switch(type) {\n                case 'int':\n                    if (!isNaN(item[0] = parseInt(item[0])))\n                        cb.apply(obj, item);\n                    break;\n                \n                case 'boolean':\n                    switch(item[0].toLowerCase()) {\n                        case 'true':\n                            item[0] = true;\n                            cb.apply(obj, item);\n                            break;\n                        \n                        case 'false':\n                            item[0] = false;\n                            cb.apply(obj, item);\n                            break;\n                    }\n                    break;\n                \n                default:\n                    cb.apply(obj, item);\n            }\n        }\n    });\n};\n\n/**\n * @memberOf $thing\n * @method cbBuilder\n */\n$thing.cbBuilder = function(self, args, cbDone) {\n    cbDone = cbDone || function(){};\n    \n    return function() {\n        var self = this,\n            args = arguments\n            ;\n        \n        $thing.agent();\n        \n        return (!args.length)\n            ? cbDone()\n            : function() {\n                var cbObj = (arguments.length)\n                    ? arguments\n                    : [$thing.Container]\n                    ;\n                \n                $thing.async.setImmediate(function() {\n                    $thing.agent(self)\n                        .apply($thing, args)\n                        .apply($thing, cbObj)\n                        ;\n                    \n                    cbDone();\n                });\n            }\n            ;\n\n    }.apply(self, args);\n};\n\n/**\n * @method agent\n * @param {*}\n */\nvar agent = $thing.agent = function() {\n    var def,\n        backtrace,\n        selector,\n        filter,\n        pattern,\n        selects,\n        callChain,\n        refCount = 0\n        ;\n\n    switch(arguments.length) {\n        case 0:\n            return $thing.Tasker.thread();\n        \n        case 1:\n            if (arguments[0] instanceof $thing.Pattern) {\n                selector = new $thing.Selector(undefined, pattern = arguments[0]);\n                break;\n            }\n            else if (   typeof arguments[0] === 'object' &&\n                        arguments[0].getInterfaces !== undefined\n            ) {\n                selector = arguments[0];\n                break;\n            }\n\n            /* falls through */\n        default:\n            var args = Array.prototype.slice.call(arguments, 0);\n            \n            def = new $thing.Definition(\n                undefined,\n                $thing.Container,\n                $thing.Agent,\n                (backtrace = $thing.getBacktrace(1)),\n                args\n            );\n\n            if (def.class !== undefined)\n                return def.refObject(function(obj, cbRelease) {\n                    cbRelease();\n                });\n            else {\n                selects = [];\n                \n                $thing.searchMeta(def, 'select', function() {\n                    selects.push(Array.prototype.slice.call(arguments, 0));\n                });\n                \n                selector = new $thing.Selector(\n                    undefined,\n                    pattern = (selects.length)\n                        ? selects\n                        : def.name,\n                    backtrace\n                );\n            }\n    }\n\n    filter = function(filters, callArgs) {          \n        return function() {\n            var obj,\n                args = Array.prototype.slice.call(arguments, 0)\n                ;\n                \n            switch(arguments.length) {\n                case 0:\n                    obj = $thing.Container;\n                    break;\n                \n                case 1:\n                    if (typeof arguments[0] === 'object' &&\n                        arguments[0].getInterfaces !== undefined\n                    ) {\n                        obj = arguments[0];\n                        break;\n                    }\n                    \n                    /* falls through */ \n                default:\n                    var backtrace = $thing.getBacktrace(1),\n                        def = new $thing.Definition(\n                            undefined,\n                            $thing.Container,\n                            $thing.Agent,\n                            backtrace,\n                            args\n                        )\n                        ;\n                    \n                    if (def.class !== undefined) \n                        obj = def;\n                    else {\n                        selects = [];\n                        \n                        $thing.searchMeta(def, 'select', function() {\n                            selects.push(Array.prototype.slice.call(arguments, 0));\n                        });\n                        \n                        obj = new $thing.Pattern(\n                            (selects.length)\n                                ? selects\n                                : def.name,\n                                backtrace\n                        );\n                    }\n                    \n                    break;\n            }\n\n            obj.refObject(function(obj, cbRelease) {\n\n                refCount++;\n\n                (pattern !== undefined)\n                    ? selector.dispatch(\n                        {   filters: filters,\n                            method: callArgs[0],\n                            args: callArgs.slice(1)\n                        },\n                        function() {\n                            return $thing.cbBuilder(\n                                obj,\n                                Array.prototype.slice.call(\n                                    arguments,\n                                    0,\n                                    arguments.length - 1\n                                ),\n                                arguments[arguments.length - 1]\n                            );\n                        },\n                        function() {\n                            if (--refCount === 0) {\n                                cbRelease();\n                                selector.release();\n                            }\n                        }\n                    )\n                    : selector.dispatch(\n                        {   filters: filters,\n                            method: callArgs[0],\n                            args: callArgs.slice(1)\n                        },\n                        function() {\n                            return $thing.cbBuilder(\n                                obj,\n                                arguments,\n                                function() {\n                                    if (--refCount === 0) {\n                                        cbRelease();\n                                    }\n                                }\n                            );\n                        }\n                    )\n                    ;\n            });\n\n            return callChain;\n        };\n    };\n\n    callChain = function() {\n        return filter(\n            $thing.Filter.ALL, \n            Array.prototype.slice.call(arguments, 0)\n        );\n    };\n\n    callChain.all = callChain;\n\n    callChain.first = function() {\n        return filter(\n            $thing.Filter.FIRST, \n            Array.prototype.slice.call(arguments, 0)\n        );\n    };\n\n    callChain.last = function() {\n        return filter(\n            $thing.Filter.LAST, \n            Array.prototype.slice.call(arguments, 0)\n        );\n    };\n\n    return callChain;\n};","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n\n/**\n * @memberOf $thing\n * @method switchContext\n */\n$thing.switchContext = function(\n    functString,\n    parentOrdinal,\n    superOrdinal,\n    ordinal,\n    superName,\n    methodName\n) {\n    functString = functString || this.$vtable[ordinal][methodName].toString();\n\n    return (\n        functString.indexOf('$parent') > -1 ||\n        functString.indexOf('$super') > -1\n    )\n        ? function() {\n            var ret,\n                $parent = this.$parent,\n                $super = this.$super\n                ;\n            \n            this.$parent = this.$vtable[parentOrdinal] || $parent;\n            this.$super = this.$vtable[superOrdinal][superName];\n\n            ret = this.$vtable[ordinal][methodName].apply(this, arguments);\n\n            this.$parent = $parent;\n            this.$super = $super;\n            \n            return ret;\n        }\n        : this.$vtable[ordinal][methodName]\n        ;\n};\n\n/**\n * @memberOf $thing\n * @method switchParentContext\n */\n$thing.switchParentContext = function(\n    functString,\n    parentOrdinal,\n    ordinal,\n    methodName\n) {\n    functString = functString || this.$vtable[ordinal][methodName].toString();\n\n    return (\n        functString.indexOf('$parent') > -1\n    )\n        ? function() {\n            var ret,\n                $parent = this.$parent\n                ;\n            \n            this.$parent = this.$vtable[parentOrdinal] || this.$parent;\n\n            ret = this.$vtable[ordinal][methodName].apply(this, arguments);\n\n            this.$parent = $parent;\n            \n            return ret;\n        }\n        : this.$vtable[ordinal][methodName]\n        ;\n};\n\n/**\n * @class Object\n * @memberOf $thing\n */\n$thing.Object = function(){};\n\n/**\n * Return object name\n * @memberOf $thing\n * @method Object#getName\n * @returns {string}\n */\n$thing.Object.prototype.getName = function(){\n    return 'Object';\n};\n\n/**\n * @memberOf $thing\n * @method Object.inherit\n * @param {object} obj\n * @param {object} parent\n * @returns {object}\n */\nvar $inherit = $thing.Object.inherit = function(obj, parent) {\n    var i,\n        j,\n        k,\n        v,\n        functString,\n        signature,\n        signatures = {},\n        inherit = this.prototype\n        ;\n        \n    function ret() {\n        /*jshint validthis:true */\n        (this.init !== undefined)\n            ? this.init.apply(this, arguments)\n            : undefined\n            ;\n    }\n\n    function replace() {\n        return (obj['$' + arguments[1]] !== undefined)\n            ? obj['$' + arguments[1]]\n            : arguments[0]\n            ;\n    }\n    \n    ret.prototype = new this();\n    ret.prototype.constructor = ret;\n    ret.prototype.$vtable = (ret.prototype.$vtable !== undefined)\n        ? ret.prototype.$vtable.slice()\n        : []\n        ;\n    \n    var ordinal = ret.prototype.$vtable.push(obj) - 1,\n        parentOrdinal = ret.prototype.$vtable.push(parent) - 1,\n        superOrdinal = ret.prototype.$vtable.push(inherit) - 1\n        ;\n    \n    ret.inherit = $inherit;\n    \n    for (i in obj) {\n        switch(i) {\n            case '$vtable':\n                /* falls through */\n            case '$signatures':\n                /* falls through */\n            case '$owner':\n                /* falls through */\n            case '$parent':\n                 /* falls through */\n            case '$super':\n                continue;\n        }\n        \n        v = obj[i];\n        k = i.replace(/\\$\\((.+?)\\)/g, replace);\n        j = k.substring(k.indexOf('.') + 1);\n        \n        if (typeof v !== 'function')\n            ret.prototype[k] = v;\n        else {\n            functString = v.toString();\n            signature = functString.match(/function[^(]*\\(([^)]*)\\)/);\n            \n            (typeof inherit[k] !== 'function')\n                ? (typeof inherit[j] !== 'function')\n                    ? ret.prototype[k] = $thing.switchParentContext.apply(\n                        ret.prototype,\n                        [   functString,\n                            parentOrdinal,\n                            ordinal,\n                            i\n                        ]\n                    )\n                    : ret.prototype[k] = $thing.switchContext.apply(\n                        ret.prototype,\n                        [   functString,\n                            parentOrdinal,\n                            superOrdinal,\n                            ordinal,\n                            j,\n                            i\n                        ]\n                    )\n                : ret.prototype[k] = $thing.switchContext.apply(\n                    ret.prototype,\n                    [   functString,\n                        parentOrdinal,\n                        superOrdinal,\n                        ordinal,\n                        k,\n                        i\n                    ]\n                )\n                ;\n            \n            if (signature !== null)\n                signatures[k] = (signature[1].length)\n                    ? signature[1].split(/,\\s*/)\n                    : []\n                    ;\n        }\n    }\n    \n    ret.prototype.$owner = parent || ret.prototype.$owner;\n    ret.prototype.$signatures = $thing.merge(\n        signatures,\n        ret.prototype.$signatures\n    );\n    \n    return ret;\n};","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n\n$thing.Base = $thing.Object.inherit({\n\n    /**\n     * @constructs Base\n     * @mixes $thing.Object\n     * @memberOf $thing\n     */\n    init: function() {},\n\n    getName: function() {\n        return 'Base';\n    },\n\n    /**\n     * Define an object property\n     * @memberOf $thing\n     * @method Base#property\n     * @param {string} prop property name\n     * @param {function} [cbGetter]\n     * @param {function} [cbSetter]\n     */\n    property: function(prop, cbGetter, cbSetter) {\n        var obj = {};\n\n        (cbGetter)\n            ? obj.get = cbGetter\n            : undefined\n            ;\n        \n        (cbSetter)\n            ? obj.set = cbSetter\n            : undefined\n            ;\n    \n        Object.defineProperty(this, prop, obj);\n    },\n\n    bind: function(funct) {\n        var self = this;\n        \n        return function() {\n            return funct.apply(self, arguments);\n        };\n    }\n\n});","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n\n$thing.State = {\n    EXPR_AND:       1,\n    EXPR_NOT:       2,\n    EXPR_OR:        3,\n    DEF_DESC:       1,\n    DEF_NAME:       2,\n    DEF_SOURCE:     4,\n    DEF_EXTENDS:    16,\n    DEF_IMPLEMENTS: 64,\n    DEF_USES:       128,\n    DEF_META:       256,\n    DEF_NOP:        512,\n    DEF_END:        1024,\n    LIFE_INITIATED: 2048,\n    LIFE_ACTIVE:    4096,\n    LIFE_WAITING:   8192,\n    LIFE_SUSPENDED: 16384,\n    LIFE_DELETED:   32768,\n    LIFE_TRANSIT:   65536,\n    LIFE_BLOCKED:   131072\n};\n\n$thing.Definition = $thing.Base.inherit({\n\n    _metaHandlers: {\n\n        mobile: function() {\n            this._isMobile = true;\n        },\n\n        passive: function() {\n            this._isPassive = true;\n        },\n\n        singleton: function() {\n            this._singleton = this._singleton || this._source;\n        },\n\n        catchall: function(catchall, methodName) {\n            this._substitute.$__catchall__ = methodName;\n        }\n\n    },\n\n    getName: function() {\n        return 'Definition';\n    },\n\n    /**\n     * @constructs Definition\n     * @mixes $thing.Base\n     * @memberOf $thing\n     * @param {object} container\n     * @param {object} parent\n     * @param {object} super\n     * @param {string[]} backtrace\n     * @param {string[]} stack\n     */\n    init: function(container, parent, _super, backtrace, stack) {\n        var k,\n            item,\n            search,\n            self = this,\n            heap = (container) \n                ? container.heap\n                : $thing.getContainer(backtrace).heap\n            ;\n\n        this.$super();\n        \n        this._state = $thing.State.DEF_DESC;\n        this._parent = parent;\n        this._children = [];\n        this._meta = [];\n        this._interfaces = [];\n        this._uses = [];\n        this._super = _super;\n        this._source = backtrace[0];\n        this._refCount = 0;\n        this._isAgent = this._super === $thing.Agent;\n        this._isAbstract = false;\n        this._isPassive = false;\n        this._isMobile = false;\n\n        this._interfaces = [\n            $thing.create64BitId(this._source, heap.length),\n            this._source\n        ];\n\n        this._substitute = {\n            $id: this._interfaces[0],\n            $source: this._source\n        };\n        \n        this.parseStack(stack);\n        \n        if (this._extends !== undefined) {\n            item = $thing.search({_name: this._extends}, heap);\n            \n            if (item === undefined) throw new Error(\n                'DefinitionError: Super Class \\'' +\n                this._extends + '\\' is not defined'\n            );\n            else {\n                this._super = item._class;\n                this._singleton = item._singleton;\n                for(k = item._meta.length - 1; k > -1; k--)\n                    this._meta.unshift(item._meta[k]);\n            }\n            \n            (this._class === undefined)\n                ? this._class = {}\n                : undefined\n                ;\n        }\n        \n        this._meta.forEach(function(item) {\n            var args = item.split(/ (.+)?/);\n            \n            (self._metaHandlers[args[0]] !== undefined)\n                ? self._metaHandlers[args[0]].apply(self, args)\n                : undefined\n                ;\n        });\n        \n        if (this._isAbstract)\n            search = {\n                _name: this._name,\n                _source: this._source\n            };\n        else if (this._singleton !== undefined)\n            search = {\n                _name: this._name,\n                _singleton: this._singleton\n            };\n        \n        if (search !== undefined && (item = $thing.search(search, heap))) {\n            this.refObject = item.bind(item.refObject);\n            \n            this.property('class', function() {\n                return item._class;\n            });\n            \n            this.property('refCount', function() {\n                return item._refCount;\n            });\n            \n            this.property('isAbstract', function() {\n                return item._isAbstract;\n            });\n            \n            this.property('isPassive', function() {\n                return item._isPassive;\n            });\n                \n            this.property('instance', function() {\n                return item._instance;\n            });\n                \n            this.property('state', function() {\n                return item._state;\n            });\n                \n            this.property('name', function() {\n                return item._name;\n            });\n            \n            this.property('parent', function() {\n                return item._parent;\n            });\n        \n        }\n        else {\n            \n            this._childrenWrapper = {\n                push: this.bind(this._pushChild),\n                forEach: this.bind(this._forEachChild)\n            };\n            \n            Object.defineProperty(this._childrenWrapper, 'length', {\n                get: this.bind(this._countChildren)\n            });\n            \n            (this._factory !== undefined)\n                ? this._class = this._factory.apply($thing, this._uses)\n                : undefined\n                ;\n            \n            if (this._class !== undefined) {\n                for(k in this._substitute)\n                    this._class[k] = this._substitute[k]\n                    ;\n                \n                var interfaces = (this._name !== undefined)\n                    ? this._interfaces.concat(this._name)\n                    : this._interfaces\n                    ;\n                \n                this._class.getInterfaces = function() {\n                    return this.$super().concat(interfaces);\n                };\n                \n                this._class = this._super.inherit(\n                    this._class,\n                    parent,\n                    this._isMobile\n                );\n                \n                $thing.attach(this, heap);\n            }\n            \n            this.property('class', function() {\n                return this._class;\n            });\n            \n            this.property('refCount', function() {\n                return this._refCount;\n            });\n            \n            this.property('isAbstract', function() {\n                return this._isAbstract;\n            });\n            \n            this.property('isPassive', function() {\n                return this._isPassive;\n            });\n            \n            this.property('instance', function() {\n                return this._instance;\n            });\n            \n            this.property('state', function() {\n                return this._state;\n            });\n            \n            this.property('name', function() {\n                return this._name;\n            });\n            \n            this.property('parent', function() {\n                return this._parent;\n            });\n        }\n\n    },\n\n    _forEachChild: function(cb) {\n        this._children.forEach(function(args) {\n            (args[0].getHeapId !== undefined)\n                ? cb.apply(undefined, args)\n                : undefined\n                ;\n        });\n    },\n\n    _pushChild: function(obj) {\n        var id = obj.getHeapId();\n    \n        for(var i = 0; i < this._children.length; i++) {\n\n            if (this._children[i][0].getHeapId === undefined)\n                this._children.splice(i, 1);\n\n            else if (this._children[i][0].getHeapId() === id)\n                return this._children.length;\n\n        }\n    \n        return this._children.push(arguments);\n    },\n\n    _countChildren: function() {\n        var length = 0;\n        \n        this._forEachChild(function(child) {\n            if (child.getRefCount())\n                length++;\n        });\n        \n        return length;\n    },\n\n    parseStack: function(stack) {\n        var item,\n            match,\n            self = this\n            ;\n        \n        function replace() {\n            return (arguments[1] === undefined)\n                ? stack.shift()\n                : self._substitute['$' + arguments[1]] = stack.shift()\n                ;\n        }\n        \n        while(  this._state !== $thing.State.DEF_END &&\n                (item = stack.shift()) !== undefined\n        ) {\n        \n            switch(typeof item) {\n                case 'function':\n                    this._state = $thing.State.DEF_END;\n                    this._factory = item;\n                    continue;\n\n                case 'object':\n                    this._state = $thing.State.DEF_END;\n                    this._class = item;\n                    continue;\n            }\n            \n            switch(item) {\n                case 'abstract':\n                    this._isPassive = this._isAbstract = true;\n                    continue;\n\n                case 'source':\n                    this._state = $thing.State.DEF_SOURCE;\n                    continue;\n\n                case 'extends':\n                    this._state = $thing.State.DEF_EXTENDS;\n                    continue;\n\n                case 'implements':\n                    this._state = $thing.State.DEF_IMPLEMENTS;\n                    continue;\n\n                case 'uses':\n                    this._state = $thing.State.DEF_USES;\n                    continue;\n\n                default:\n                    (this._state === $thing.State.DEF_META || item.charAt(0) === '@')\n                        ? this._state = $thing.State.DEF_META\n                        : (item.match(/ /))\n                            ? this._state = $thing.State.DEF_DESC\n                            : undefined\n                            ;\n            }\n            \n            switch(this._state) {\n\n                case $thing.State.DEF_DESC:\n                    item = item.replace(/\\$\\((.+?)\\)|\\$/g, replace);\n                    \n                    item = item.split(' @');\n\n                    stack = item[0].split(/ +/).filter(Boolean).concat(\n                        (item[1] !== undefined)\n                            ? ['@' + item[1]].concat(stack)\n                            : stack\n                    );\n\n                    (this._name === undefined)\n                        ? this._state = $thing.State.DEF_NAME\n                        : this._state = $thing.State.DEF_NOP\n                        ;\n                    break;\n                    \n                case $thing.State.DEF_META:\n                    item = item.replace(/\\$\\((.+?)\\)|\\$/g, replace);\n                    \n                    if (item.charAt(item.length - 1) === '+') {\n                        stack = [\n                            item.slice(0, -1) + stack.shift()\n                        ].concat(stack);\n                    }\n                    else {\n                        this._state = $thing.State.DEF_DESC;\n                        this._meta.push(item.slice(1));\n                    }\n                    \n                    break;\n                \n                case $thing.State.DEF_NAME:\n                    this._name = item || this._name;\n                    break;\n                \n                case $thing.State.DEF_SOURCE:\n                    this._source = item || this._source;\n                    break;\n                \n                case $thing.State.DEF_EXTENDS:\n                    this._extends = item || this._extends;\n                    break;\n                \n                case $thing.State.DEF_IMPLEMENTS:\n                    ((match = item.match(/^\\/(.*?)\\/([gimy]*)$/)) !== null)\n                        ? this._interfaces.push(\n                            new RegExp(match[1], match[2])\n                        )\n                        : this._interfaces.push(item)\n                        ;\n                    break;\n                \n                case $thing.State.DEF_USES:\n                    this._uses.push($thing.agent(item));\n                    break;\n            }\n        }\n    },\n\n    patchObject: function(obj) {\n        var self = this;\n        \n        obj.refObject = this.bind(this.refObject);\n        \n        obj.getRefCount = function() {\n            return self._refCount;\n        };\n        \n        obj.getHeapId = function() {\n            return self._id;\n        };\n        \n        obj.getName = function() {\n            return self._name;\n        };\n        \n        obj.getSource = function() {\n            return self._source;\n        };\n        \n        obj.getChildren = function() {\n            return self._childrenWrapper;\n        };\n        \n        obj.getState = function() {\n            return self._state;\n        };\n        \n        obj.setState = function() {\n            var states = Array.prototype.slice.call(arguments, 0);\n            \n            states.forEach(function(state) {\n                self._state |= state;\n            });\n            \n            this.getChildren().forEach(function(child) {\n                child.setState(states);\n            });\n        };\n        \n        obj.unsetState = function() {\n            var states = Array.prototype.slice.call(arguments, 0);\n            \n            states.forEach(function(state) {\n                self._state &= ~state;\n            });\n            \n            this.getChildren().forEach(function(child) {\n                child.unsetState(states);\n            });\n        };\n        \n        obj.getMeta = function() {\n            return self._meta;\n        };\n        \n        obj.isAbstract = function() {\n            return self._isAbstract;\n        };\n        \n        return obj;\n    },\n\n    unpatchObject: function(obj) {\n        delete obj.refObject;\n        delete obj.getRefCount;\n        delete obj.getHeapId;\n        delete obj.getName;\n        delete obj.getSource;\n        delete obj.getChildren;\n        delete obj.getState;\n        delete obj.setState;\n        delete obj.unsetState;\n        delete obj.getMeta;\n        delete obj.isAbstract;\n        \n        return obj;\n    },\n\n    refObject: function(cb) {\n        var self = this;\n        \n        this.parent.refObject(function(parent, cbRelease) {\n            var constructed;\n            \n            if (self._refCount)\n                self._refCount++;\n            else {\n                self._refCount = constructed = 1;\n                self._instance = self.patchObject(new self._class());\n                self._instance.setState($thing.State.LIFE_INITIATED);\n            }\n            \n            if (constructed && self._isAgent && !self._isAbstract)\n                self._instance.setup();\n            cb(\n                self._instance,\n                function() {\n                    if (self._isAgent && self._isPassive) return;\n                    else if (--self._refCount !== 0) cbRelease();\n                    else {\n                        if (self._isAgent)\n                            self._instance.takedown(\n                                function() {\n                                    self._children = [];\n                                    self.unpatchObject(self._instance);\n                                    \n                                    delete self._instance;\n                                    \n                                    cbRelease();\n                                }\n                            );\n                        else {\n                            self._children = [];\n                            self.unpatchObject(self._instance);\n                            \n                            delete self._instance;\n                            \n                            cbRelease();\n                        }\n                    }\n                }\n            );\n        });\n    }\n\n});","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';  \n\n/**\n * @class Delegate\n * @mixes $thing.Base\n * @memberOf $thing\n */\n$thing.Delegate = $thing.Base.inherit({\n\n    getName: function() {\n        return 'Delegate';\n    },\n\n    /**\n     * @memberOf $thing\n     * @method Delegate#getInterfaces\n     * @returns {string[]}\n     */\n    getInterfaces: function() {\n        return [];\n    },\n\n    /**\n     * @memberOf $thing\n     * @method Delegate#matchInterface\n     * @param {string} pattern\n     * @param {string} source\n     * @returns {string}\n     */\n    matchInterface: function(pattern) {\n        var interfaces = this.getInterfaces();\n\n        for(var i = 0; i < interfaces.length; i++)\n            if ((interfaces[i] instanceof RegExp)\n                    ? pattern.match(interfaces[i]) !== null\n                    : interfaces[i] === pattern\n            ) break;\n            \n        return interfaces[i];\n    },\n\n    /**\n     * @memberOf $thing\n     * @method Delegate#refObject\n     */\n    refObject: function(cb) {\n        cb(this, function(){});\n    },\n\n    /**\n     * @memberOf $thing\n     * @method Delegate#dispatch\n     * @param {object} call\n     */\n    dispatch: function(call, cb) {\n        var method,\n            signature\n            ;\n\n        cb = cb || function() {};\n            \n        // Don't dispatch to unpatched delegates\n        //if (this.getRefCount === undefined) return cb();\n\n        // Don't dispatch to methods with $ prefix \n        if (call.method.charAt(0) === '$') return cb(); \n\n        // Check for method name prefixed with interface\n        (this[method = call.interface + '.' + call.method] === undefined)\n            ? (this[method = call.method] === undefined)\n                ? method = undefined\n                : undefined\n            : undefined\n            ;\n\n            // Check method has a name\n        (   method === undefined ||\n            // Does the signature for the method exist\n            (signature = this.$signatures[method]) === undefined ||\n            // Last argument of signature must be prefixed with $ \n            signature[signature.length - 1].charAt(0) !== '$' ||\n            // Number of signature arguments must match the number of\n            // call arguments plus callback object\n            signature.length !== call.args.length + 1\n        )\n            // Didn't match, check for catch all\n            ? ( this[method = this.$__catchall__] === undefined ||\n            // Catch all signature must exist\n                (signature = this.$signatures[method]) === undefined ||\n                // Last argument is prefix with $\n                signature[1].charAt(0) !== '$' ||\n                // 2 arguments\n                signature.length !== 2\n            )\n                // Didn't match, skip call\n                ? cb()\n                // Matched, call catch all\n                : this[this.$__catchall__].apply(\n                    this,\n                    [call.args, cb]\n                )\n            // Matched, make call\n            : this[method].apply(\n                this,\n                call.args.concat(cb)\n            )\n            ;\n    }\n\n});","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n    \n$thing.Pattern = $thing.Delegate.inherit({\n\n    getName: function() {\n        return 'Pattern';\n    },\n\n    /**\n     * @constructs Pattern\n     * @mixes $thing.Delegate\n     * @memberOf $thing\n     * @param {(string|string[])} pattern\n     * @param {string[]} backtrace\n     */\n    init: function(pattern, backtrace) {\n        this.$super();\n        this._pattern = pattern;\n        this.property('backtrace', function() {\n            return backtrace;\n        });\n    },\n\n    /**\n     * @memberOf $thing\n     * @method Pattern#toArray\n     * @returns {string[]}\n     */\n    toArray: function() {\n        return (this._pattern instanceof Array)\n            ? this._pattern\n            : [[this._pattern]]\n            ;\n    }\n\n});","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n\n/**\n * @class Agent\n * @mixes $thing.Delegate\n * @memberOf $thing\n */\n$thing.Agent = $thing.Delegate.inherit({\n\n    getName: function() {\n        return 'Agent';\n    },\n\n    getInterfaces: function() {\n        return ['Agent'];\n    },\n\n    /**\n     * @memberOf $thing\n     * @method Agent#setup\n     */\n    setup: function(cb) {\n        this.setState($thing.State.LIFE_ACTIVE);\n        this.doActivate(cb);\n    },\n\n    /**\n     * @memberOf $thing\n     * @method Agent#takedown\n     */\n    takedown: function(cb) {\n        this.doDelete(cb);\n    },\n\n    /**\n     * @memberOf $thing\n     * @method Agent#doActivate\n     */\n    doActivate: function(cb) {\n        this.unsetState($thing.State.LIFE_SUSPENDED);\n        if (cb) cb();\n        $thing.agent();\n    },\n\n    /**\n     * @memberOf $thing\n     * @method Agent#doDelete\n     */\n    doDelete: function(cb) {\n        this.setState($thing.State.LIFE_DELETED);\n        if (cb) cb();\n        $thing.agent();\n    },\n\n    /**\n     * @memberOf $thing\n     * @method Agent#doSuspend\n     */\n    doSuspend: function(cb) {\n        this.setState($thing.State.LIFE_SUSPENDED);\n        if (cb) cb();\n        $thing.agent();\n    },\n\n    /**\n     * @memberOf $thing\n     * @method Agent#doWait\n     */\n    doWait: function(cb) {\n        this.setState($thing.State.LIFE_WAITING);\n        if (cb) cb();\n        $thing.agent();\n    },\n\n    /**\n     * @memberOf $thing\n     * @method Agent#doWake\n     */\n    doWake: function(cb) {\n        this.unsetState($thing.State.LIFE_WAITING);\n        if (cb) cb();\n        $thing.agent();\n    },\n\n    /**\n     * @memberOf $thing\n     * @method Agent#addBehaviour\n     * @param {*}\n     * @returns {$thing.Behaviour}\n     */\n    addBehaviour: function() {\n        var obj,\n            reset,\n            self = this,\n            args = Array.prototype.slice.call(arguments, 0),\n            def = new $thing.Definition(\n                undefined,\n                this,\n                $thing.Behaviour,\n                $thing.getBacktrace(1),\n                args\n            )\n            ;\n\n        if (def.class !== undefined) {\n            var funct = function() {\n\n                (!def.refCount)\n                    ? def.refObject(function(instance, cbRelease) {\n                        $thing.attach(def);\n                        obj = instance;\n                        self.getChildren().push(obj, cbRelease);\n                    })\n                    : obj = def.instance\n                    ;\n                    \n                obj.unsetState(\n                    $thing.State.LIFE_WAITING |\n                    $thing.State.LIFE_SUSPENDED |\n                    $thing.State.LIFE_DELETED |\n                    $thing.State.LIFE_TRANSIT |\n                    $thing.State.LIFE_BLOCKED\n                );\n                \n                obj.setState(self.getState() | $thing.State.LIFE_ACTIVE);\n                \n                $thing.agent();\n            };\n            \n            funct();\n            \n            reset = obj.reset;\n            \n            obj.reset = function() {\n                funct();\n                reset.apply(obj, arguments);\n            };\n        }\n        \n        return obj;\n    },\n\n    /**\n     * @memberOf $thing\n     * @method Agent#removeBehaviour\n     * @param {string|$thing.Behaviour}\n     */\n    removeBehaviour: function() {\n        var objs = [],\n            children = this.getChildren()\n            ;\n            \n        if (typeof arguments[0] === 'object' &&\n            arguments[0].getHeapId !== undefined\n        ) {\n            var id = arguments[0].getHeapId();\n            \n            children.forEach(function(obj, cbRelease) {\n                if (obj.getHeapId() === id) {\n                    obj.setState($thing.State.LIFE_DELETED);\n                    cbRelease();\n                    objs.push(obj);\n                }\n            });\n        }\n        else {\n            var args = Array.prototype.slice.call(arguments, 0),\n                def = new $thing.Definition(\n                    undefined,\n                    this,\n                    $thing.Behaviour,\n                    $thing.getBacktrace(1),\n                    args\n                )\n                ;\n                \n            children.forEach(function(obj, cbRelease) {\n                if (obj.getName() === def.name) {\n                    obj.setState($thing.State.LIFE_DELETED);\n                    cbRelease();\n                    objs.push(obj);\n                }\n            });\n        }\n\n        return objs;\n    }\n\n});\n","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';    \n\n/**\n * @class Behaviour\n * @mixes $thing.Delegate\n * @memberOf $thing\n */\n$thing.Behaviour = $thing.Delegate.inherit({\n\n    getName: function() {\n        return 'Behaviour';\n    },\n\n    getInterfaces: function() {\n        return [\n            'Behaviour', \n            'parent:' + this.$parent.$id,\n            'owner:' + this.$owner.$id\n        ];\n    },\n\n    done: function() {\n        return false;\n    },\n\n    action: function($cb) {\n        if (this.done()) \n            this.$owner.removeBehaviour(this);\n            \n        if ($cb) $cb();\n    },\n\n    block: function(cb) {\n        this.setState($thing.State.LIFE_BLOCKED);\n        if (cb) cb();\n    },\n\n    restart: function(cb) {\n        this.unsetState($thing.State.LIFE_BLOCKED);\n        if (cb) cb();\n    },\n\n    reset: function(cb) {\n        if (cb) cb();\n    }\n\n});","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n\n$thing.Filter = {\n    ALL:            1,\n    FIRST:          2,\n    LAST:           4\n};\n\n$thing.Selector = $thing.Base.inherit({\n\n    getName: function() {\n        return 'Selector';\n    },\n\n    /**\n     * @constructs Selector\n     * @mixes $thing.Base\n     * @memberOf $thing\n     * @param {object} container\n     * @param {(string|string[]|$thing.Pattern)} pattern\n     * @param {string[]} backtrace\n     * @param {boolean} [includePassive=true]\n     * @param {*[]} [heap=$thing.heap]\n     */\n    init: function(container, pattern, backtrace, includePassive) {\n        var i,\n            include,\n            def,\n            heap\n            ;\n\n        this.$super();\n\n        this._exprs = [];\n        this._selection = [];\n        this._callbacks = [];\n        this._backtrace = backtrace;\n        this._source = this._backtrace !== undefined \n            ? this._backtrace[0] \n            : undefined\n            ;\n        \n        if (pattern instanceof $thing.Pattern) {\n            this._backtrace = pattern.backtrace;\n            this._source = this._backtrace[0];\n            pattern = pattern.toArray();\n        }\n        else if (typeof pattern === 'string') {\n            var expr = {\n                and: {},\n                not: {}\n            };\n            \n            expr.and[pattern] = true;\n            \n            this._exprs.push(expr);\n        }\n        \n        if (pattern instanceof Array) {\n            for(i = 0; i < pattern.length; i++) {\n                this.parseStack(pattern[i]);\n            }\n        }\n        \n        includePassive =\n            (includePassive === undefined)\n                ? true\n                : includePassive\n                ;\n        \n        heap = (container) \n            ? container.heap \n            : $thing.getContainer(this._backtrace).heap\n            ;\n\n        for(i = 0; i < heap.length; i++) {\n            def = heap[i];\n            \n            include = (def.isPassive)\n                ? (def.isPassive & includePassive) &&\n                    def.state < $thing.State.LIFE_SUSPENDED\n                : (includePassive)\n                    ? def.state < $thing.State.LIFE_SUSPENDED\n                    : def.state < $thing.State.LIFE_WAITING\n                    ;\n\n            if (!def.isAbstract &&\n                def.refCount > 0 &&\n                def.state & $thing.State.LIFE_ACTIVE &&\n                include\n            )\n                def.refObject(this.bind(this.matchObject));\n\n        }\n        \n        this.property('length', function() {\n            return this._selection.length;\n        });\n    },\n\n    parseStack: function(stack) {\n        var k,\n            item,\n            state = $thing.State.EXPR_AND,\n            expr = {\n                and: {},\n                not: {}\n            }\n            ;\n        \n        while((item = stack.shift()) !== undefined) {\n            \n            switch(item) {\n                case 'and':\n                    state = $thing.State.EXPR_AND;\n                    continue;\n                \n                case 'not':\n                    state = $thing.State.EXPR_NOT;\n                    continue;\n                \n                case 'or':\n                    state = $thing.State.EXPR_OR;\n                    continue;\n            }\n\n            switch(state) {\n                case $thing.State.EXPR_AND:\n                    expr.and[item] = true;\n                    break;\n                \n                case $thing.State.EXPR_NOT:\n                    expr.not[item] = true;\n                    break;\n                \n                case $thing.State.EXPR_OR:\n                    for (k in expr.and) {\n                        this._exprs.push(expr);\n                        break;\n                    }\n                    \n                    expr = {\n                        and: {},\n                        not: {}\n                    };\n                    \n                    expr.and[item] = true;\n                    break;\n            }\n        }\n        \n        for (k in expr.and) {\n            this._exprs.push(expr);\n            break;\n        }\n    },\n\n    matchObject: function(obj, cbRelease) {\n        var k,\n            match\n            ;\n        \n        for (var i = 0; i < this._exprs.length; i++) {\n            var m,\n                expr = this._exprs[i]\n                ;\n            \n            for(k in expr.and)\n                if ((m = obj.matchInterface(k, this._source)) !== undefined)\n                    match = match || m;\n                else {\n                    match = undefined;\n                    break;\n                }\n                \n            if (match === undefined)\n                continue;\n                \n            for(k in expr.not)\n                if (obj.matchInterface(k, this._source)) {\n                    match = undefined;\n                    cbRelease();\n                    return;\n                }\n\n            if (match !== undefined)\n                break;\n        }\n            \n        if (match === undefined)\n            cbRelease();\n        else {\n            this._callbacks.push(cbRelease);\n            this._selection.push({match: match, obj: obj});\n        }\n    \n    },\n\n    dispatch: function(call, cbItem, cbDone) {\n        $thing.async.setImmediate(this.bind(function() {\n\n            if (call.filters & $thing.Filter.FIRST &&\n                this._selection.length > 0\n            ) {\n\n                this._selection[0].obj.dispatch(\n                    {   interface: this._selection[0].match,\n                        method: call.method,\n                        args: call.args\n                    },\n                    this.bind(function() {\n                        return cbItem.apply(\n                            this._selection[0].obj,\n                            Array.prototype.slice.call(\n                                arguments,\n                                0\n                            ).concat(cbDone)\n                        );\n                    })\n                );\n\n            }\n            else if (   call.filters & $thing.Filter.LAST &&\n                        this._selection.length > 0\n            ) {\n                var i = this._selection.length - 1;\n\n                this._selection[i].obj.dispatch(\n                    {   interface: this._selection[i].match,\n                        method: call.method,\n                        args: call.args\n                    },\n                    this.bind(function() {\n                        return cbItem.apply(\n                            this._selection[i].obj,\n                            Array.prototype.slice.call(\n                                arguments,\n                                0\n                            ).concat(cbDone)\n                        );\n                    })\n                );\n            }\n            else if (   call.filters & $thing.Filter.ALL &&\n                        this._selection.length > 0\n            ) {\n\n                $thing.async.each(\n                    this._selection,\n                    function(item, cbNext) {\n                        item.obj.dispatch(\n                            {   interface: item.match,\n                                method: call.method,\n                                args: call.args\n                            },\n                            function() {\n                                return cbItem.apply(\n                                    item.obj,\n                                    Array.prototype.slice.call(\n                                        arguments,\n                                        0\n                                    ).concat(cbNext)\n                                );\n                            }\n                        );\n                    },\n                    cbDone\n                );\n            \n            }\n            else {\n\n                cbDone();\n\n            }\n\n        }));\n    },\n\n    release: function() {\n        for(var i = 0; i < this._callbacks.length; i++)\n            this._callbacks[i]();\n        this._callbacks = [];\n        this._selection = [];\n    }\n\n});","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n\n/**\n * @class Container\n * @mixes $thing.Agent\n * @memberOf $thing\n */\n$thing.Container = new ($thing.Agent.inherit({\n    \n    getName: function() {\n        return 'Container';\n    },\n    \n    getInterfaces: function() {\n        return ['Container'];\n    },\n    \n    setup: undefined,\n    takedown: undefined,\n    addBehaviour: undefined,\n    removeBehaviour: undefined\n\n}))();\n","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n\n/**\n * @class Tasker\n * @mixes $thing.Base\n * @memberOf $thing\n */\n$thing.Tasker = new ($thing.Base.inherit({\n\n    doWake: function(container) {\n        var now = $thing.getMicroTime();\n\n        if (!container.nextWakeTime || now >= container.nextWakeTime) {\n\n            var selector = new $thing.Selector(\n                    container,\n                    [['Behaviour', 'and', 'Waker']], \n                    ['$container:0:0', '$thing'], \n                    false\n                )\n                ;\n\n            if (selector.length === 0) {\n                selector.release();\n                selector = undefined;\n            }\n            else {\n                selector.dispatch(\n                    {   filters: $thing.Filter.ALL,\n                        method: 'action',\n                        args: []\n                    },\n                    function(cbNext) {\n                        cbNext();\n                    },\n                    function() {\n                        selector.release();\n                        selector = undefined;\n                    }\n                );\n            }\n\n            container.nextWakeTime =   \n                now + $thing.WAKE_MIN_PERIOD - (now % $thing.WAKE_MIN_PERIOD);\n        }\n\n    },\n\n    doAction: function(container) {\n        var self = this;\n\n        if (container.isActionTaskQueued) return;\n        container.isActionTaskQueued = true;\n\n        $thing.async.setImmediate(function() {\n            var selector = new $thing.Selector(\n                    container,\n                    [['Behaviour', 'not', 'Waker']], \n                    ['$container:0:0', '$thing'], \n                    false\n                )\n                ;\n        \n            if (selector.length === 0) {\n                selector.release();\n                selector = undefined;\n                container.isActionTaskQueued = false;\n            }\n            else {\n                selector.dispatch(\n                    {   filters: $thing.Filter.ALL,\n                        method: 'action',\n                        args: []\n                    },\n                    function(cbNext) {\n                        cbNext();\n                    },\n                    function() {\n                        selector.release();\n                        selector = undefined;\n                        container.isActionTaskQueued = false;\n                        self.doAction(container);\n                    }\n                );\n            }\n\n        });\n\n    },\n\n    thread: function() {\n        var container = $thing.getContainer($thing.getBacktrace());\n\n        this.doWake(container);\n        this.doAction(container);\n    }\n    \n}))();","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n\n/**\n * @class Heartbeat\n * @mixes $thing.Agent\n * @abstract\n * @singleton\n */\n$thing.agent(\n    '@singleton', \n    'abstract Heartbeat implements Container', {\n\n        setup: function(cb) {\n            this.$super(cb);\n            \n            this.keepAlive = this.addBehaviour('@passive', {});\n\n            this.intervalId = setInterval(\n                $thing.agent, \n                $thing.WAKE_MIN_PERIOD / 1000\n            );\n        },\n            \n        /**\n         * @method Heartbeat#destroy\n         */\n        destroy: function($cb) {\n                \n            clearInterval(this.intervalId);\n\n            this.removeBehaviour(this.keepAlive);\n\n            $cb();\n        }\n    }\n);","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n\n$thing.agent('@singleton', {\n    \n    setup: function(cb) {\n        this.$super(cb);\n\n        /**\n         * @class Flow\n         * @abstract\n         * @mixes $thing.Behaviour\n         */\n        this.addBehaviour('abstract Flow', {\n\n            /**\n             * @method Flow#getFlow\n             * @returns {function[]}\n             */\n            getFlow: function() {\n                var self = this,\n                    reset = this.reset,\n                    getFlow = this.getFlow,\n                    methods = [],\n                    names = [],\n                    args = Array.prototype.slice.call(arguments, 0)\n                    ;\n                    \n                args.forEach(function(item) {\n                    if (names.indexOf(item) === -1)\n                        names.push(item);\n                });\n                    \n                $thing.searchMeta(this, 'flow', function() {\n                    Array.prototype.slice.call(arguments, 0).forEach(\n                        function(item) {\n                            if (names.indexOf(item) === -1)\n                                names.push(item);\n                        }\n                    );\n                });\n\n                names.forEach(function(item) {\n                    if (self.$signatures[item] !== undefined &&\n                        self.$signatures[item]\n                        [self.$signatures[item].length - 1].charAt(0) === '$'\n                    )\n                        methods.push(function() {\n                            var cbYield = arguments[arguments.length - 1],\n                                args = Array.prototype.slice.call(\n                                    arguments,\n                                    0,\n                                    arguments.length - 1\n                                )\n                                ;\n                                \n                            args.push(function() {\n                                var args = arguments;\n                                    \n                                return (args.length === 0)\n                                    ? cbYield()\n                                    : function() {\n                                        // This needs improvement                                  \n                                        $thing.agent(new ($thing.Agent.inherit({\n\n                                            done: function($cb) {\n                                                var i = names.indexOf(item);\n                                                    \n                                                names.splice(i, 1);\n                                                methods.splice(i, 1);\n                                                \n                                                $cb();\n                                                cbYield();\n                                            },\n                                                    \n                                            yield: function($cb) {\n                                                $cb();\n                                                cbYield();\n                                            }\n\n                                        }))())\n                                        .apply($thing, args)\n                                        .apply($thing, [])\n                                        ;\n                                    }\n                                    ;\n                            });\n                            \n                            self[item].apply(self, args);\n                        \n                        });\n                               \n                });\n                    \n                this.reset = function(cb) {\n                    this.getFlow = getFlow;\n                    return reset.apply(this, [cb]);\n                };\n                    \n                this.getFlow = function() {\n                    return methods;\n                };\n                    \n                return methods;\n            },\n\n            action: function($cb) {\n                if (!this.getFlow().length)\n                    this.done = function() {\n                        return true;\n                    };\n                            \n                this.$super($cb);\n            },\n                \n            done: function() {\n                return false;\n            }\n\n        });\n    }\n\n});","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n\n$thing.agent('@singleton', {\n    \n    setup: function(cb) {\n        this.$super(cb);\n    \n        /**\n         * @class Series\n         * @mixes Flow\n         * @abstract\n         */\n        this.addBehaviour('abstract Series extends Flow', {\n    \n            action: function($cb) {\n                $thing.async.series(\n                    this.getFlow(),\n                    this.bind(function() {\n                        this.$super($cb);\n                    })\n                );\n            }\n    \n        });\n    }\n\n});","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n\n$thing.agent('@singleton', {\n    \n    setup: function(cb) {\n        this.$super(cb);\n    \n        /**\n         * @class Parallel\n         * @mixes Flow\n         * @abstract\n         */\n        this.addBehaviour('abstract Parallel extends Flow', {\n    \n            action: function($cb) {\n                $thing.async.parallel(\n                    this.getFlow(),\n                    this.bind(function() {\n                        this.$super($cb);\n                    })\n                );\n            }\n    \n        });\n    }\n\n});","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n\n$thing.agent('@singleton', {\n    \n    setup: function(cb) {\n        this.$super(cb);\n    \n        /**\n         * @class Queue\n         * @mixes Flow\n         * @abstract\n         */\n        this.addBehaviour('abstract Queue extends Flow', {\n        \n            /**\n            * @method Queue#getQueue\n            */\n            getQueue: function() {\n                var self = this,\n                    concurrency = 1,\n                    limit = 0,\n                    functs = [],\n                    active = 0,\n                    paused = false\n                    ;\n\n                $thing.searchMeta(this, 'concurrency', 'int', function(value) {\n                    concurrency = value;\n                });\n            \n                $thing.searchMeta(this, 'limit', 'int', function(value) {\n                    limit = value;\n                });\n            \n                var queue = {\n                \n                    push: function(item, cbItem) {\n                    \n                        if (limit && functs.length > limit - 1) {\n                            cbItem(-1);\n                            return;\n                        }\n                    \n                        if (!paused)\n                            self.unsetState($thing.State.LIFE_WAITING);\n                    \n                        functs.push(function(cbDone) {\n                            var flow = self.getFlow();\n                        \n                            if (!flow.length) {\n                                cbDone();\n                                cbItem(-1);\n                            }\n                            else {\n                                $thing.async.applyEach(\n                                    flow,\n                                    item,\n                                    function(err) {\n                                        cbDone();\n                                        cbItem(err);\n                                    }\n                                );\n                            }\n                    \n                        });\n                \n                    },\n                \n                    action: function(next, cb) {\n                        var call = [],\n                            length = (functs.length < concurrency)\n                                ? functs.length\n                                : concurrency\n                                ;\n                    \n                        while(length--)\n                            call.push(functs.shift());\n                        \n                        if (call.length > 0) {\n                            active = call.length;\n                            \n                            $thing.async.parallel(call, function() {\n                                active = 0; \n                                next(cb);\n                            });\n                        }\n                        else {\n                            self.setState($thing.State.LIFE_WAITING);\n                            next(cb);\n                        }\n                    },\n                \n                    pause: function() {\n                        if (!paused) {\n                            paused = true;\n                            self.setState($thing.State.LIFE_WAITING);\n                        }\n                    },\n                \n                    resume: function() {\n                        if (paused) {\n                            paused = false;\n                            self.unsetState($thing.State.LIFE_WAITING);\n                            $thing.agent();\n                        }\n                    }   \n        \n                };\n        \n                Object.defineProperty(queue, 'length', {\n                    get: function() {\n                        return active + functs.length;\n                    }\n                });\n        \n                this.getQueue = function() {\n                    return queue;\n                };\n        \n                return queue;\n            },\n    \n            action: function($cb) {\n                this.getQueue().action(this.bind(this.$super), $cb);\n            },\n    \n            /**\n             * @method Queue#push\n             */\n            push: function(items, $cb) {\n                if (items instanceof Array) {\n                    var self = this,\n                        length = items.length,\n                        errs = [],\n                        ret\n                        ;\n            \n                    items.forEach(function(item, i) {\n                        self.getQueue().push(item, function(err) {\n                            ret = (errs[i] = err) || ret;\n                    \n                            if (!--length)\n                                (ret)\n                                    ? $cb('doneWithError', errs)()\n                                    : $cb('done')()\n                                    ;            \n                        });\n                    });\n                }\n                else {\n                    this.getQueue().push(items, function(err) {\n                        (err)\n                            ? $cb('doneWithError', err)()\n                            : $cb('done')()\n                            ;\n                    });\n                }\n        \n                $thing.agent();\n            },\n    \n            pause: function($cb) {\n                this.getQueue().pause();\n                $cb();\n            },\n    \n            resume: function($cb) {\n                this.getQueue().resume();\n                $cb();\n            }\n\n        });\n    }\n\n});","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n\n$thing.WAKE_MIN_PERIOD = 50000;\n\n$thing.agent('@singleton', {\n    \n    setup: function(cb) {\n        this.$super(cb);\n    \n        /**\n         * @class Waker\n         * @mixes Behaviour\n         * @abstract\n         */\n        this.addBehaviour('abstract Waker', {\n\n            /**\n             * @method Waker#getWakeTime\n             */\n            getWakeTime: function() {\n                var time,\n                    period = 1000000,\n                    now = $thing.getMicroTime()\n                    ;\n\n                $thing.searchMeta(this, 'period', 'int', function(value) {\n                    period = value * 1000;\n                });\n\n                time = now + period - (now % period);\n\n                this.getWakeTime = function() {\n                    return time;\n                };\n                        \n                return this.getWakeTime();\n            },\n\n            /**\n             * @method Waker#wake\n             */\n            wake: function(cb) {\n                cb();\n            },\n\n            action: function($cb) {\n                var time = this.getWakeTime();\n\n                if (time === undefined) \n                    return this.$super($cb);\n                else if ($thing.getMicroTime() >= time) {\n                    this.getWakeTime = function() {\n                        return undefined;\n                    };\n                    \n                    return this.wake(\n                        this.bind(function() {\n                            this.$super($cb);\n                        })\n                    );\n                }\n\n                this.$super($cb);\n            },\n\n            done: function() {\n                if (this.getWakeTime() !== undefined)\n                    return false;\n                else {\n                    delete this.getWakeTime;\n                    return true;\n                }\n            },\n\n            reset: function($cb) {\n                delete this.getWakeTime;\n                this.$super($cb);\n            },\n\n            /**\n             * @method Waker#stop\n             */\n            stop: function($cb) {\n                this.$owner.removeBehaviour(this);\n                delete this.getWakeTime;\n                if ($cb) $cb();\n            }\n \n        });\n    }\n\n});","/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n\n$thing.agent('@singleton', 'Util', {\n\n    setup: function(cb) {\n        this.$super(cb);\n\n        /**\n         * @class Done\n         * @mixes $thing.Behaviour\n         */\n        this.addBehaviour(\n            '@passive',\n            '@catchall catchAll',\n            'Done', {\n                catchAll: function(args, $cb) {\n                    $cb('done')();\n                }\n            }\n        );\n\n        /**\n         * @class Error\n         * @mixes $thing.Behaviour\n         */\n        this.addBehaviour(\n            '@passive',\n            '@catchall catchAll',\n            'Error', {\n                catchAll: function(args, $cb) {\n                    $cb('doneWithError', -1)();\n                }\n            }\n        );\n\n        /**\n         * @class Sensor\n         * @mixes Queue\n         * @abstract\n         */\n        this.addBehaviour('abstract Sensor extends Queue');\n\n        /**\n         * @class Actuator\n         * @mixes Queue\n         * @abstract\n         */\n        this.addBehaviour('abstract Actuator extends Queue');\n\n        /**\n         * @class Bridge\n         * @mixes Queue\n         * @abstract\n         */\n        this.addBehaviour(\n            'abstract Bridge extends Queue implements Actuator Sensor'\n        );\n    }\n    \n});"]}
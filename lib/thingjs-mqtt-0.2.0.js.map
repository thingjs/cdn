{"version":3,"sources":["thingjs-agent-0.2.0/transport/Mqtt.js"],"names":[],"mappings":"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","file":"thingjs-mqtt-0.2.0.js","sourcesContent":["/*\nCopyright (c) 2015 Simon Cullen, http://github.com/cullens\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n'use strict';\n\nif (!$thing.usePaho)\n    var mqtt = require('mqtt');\n\n$thing.agent('abstract Mqtt implements Container', {\n\n    setup: function(cb) {\n        this.$super(cb);\n\n        if ($thing.usePaho)\n            this.port = 80;\n        else\n            this.port = 1883;\n\n        this.reconnectPeriod = 1000;\n\n        this.isConnecting = false;\n        this.isConnected = false;\n\n        this.actuatorsTotal = 0;\n\n        this.topicRefs = {};\n        this.pendingSubs = {};\n        this.pendingUnsubs = {};\n\n        var z = -1,\n            self = this\n            ;\n\n        $thing.searchMeta(this, 'host', 'string', function(value) {\n            self.host = value;\n        });\n\n        $thing.searchMeta(this, 'port', 'int', function(value) {\n            self.port = value;\n        });\n\n        $thing.searchMeta(this, 'clientId', 'string', function(value) {\n            self.clientId = value;\n        });\n\n        $thing.searchMeta(this, 'reconnectPeriod', 'int', function(value) {\n            self.reconnectPeriod = value;\n        });\n\n        if (this.host === undefined)\n            throw new Error('Mqtt: Missing @host');\n \n        if (this.clientId === undefined)\n            this.clientId = 'xxxxxxxx-xxxx-4xxz-yzzz-zzzzzzzzzzzz'.replace(\n                /[xyz4-]/g, \n                function(c) {\n                    switch(c) {\n                        case 'x':\n                            return (\n                                Math.floor(Math.random() * 100) % 16\n                            ).toString(16);\n                        case 'y':\n                            return '8';\n                        case 'z':\n                            return self.$id.charAt(++z);\n                        case '-':\n                        case '4':\n                            return c;\n                    }\n                }\n            );\n\n    },\n    \n    destroy: function($cb) {\n        this.getChildren().forEach(function(child) {\n            if (!child.isAbstract())\n                if (child.matchInterface('Sensor') !== undefined ||\n                    child.matchInterface('Actuator') !== undefined\n                )\n                    child.$owner.removeBehaviour(child);\n        });\n\n        $cb();\n    },\n\n    addBehaviour: function() {\n        var doConnect = false,\n            obj = this.$super.apply(this, arguments)\n            ;\n        \n        if (obj !== undefined && !obj.isAbstract()) {\n \n            if (obj.matchInterface('Sensor') !== undefined) {\n                obj.subTopic = obj.getName();\n\n            if (this.topicRefs[obj.subTopic] !== undefined)\n                this.topicRefs[obj.subTopic]++;\n            else {\n                this.topicRefs[obj.subTopic] = 1;\n\n                if (this.isConnected)\n                    this.doSubscribe(obj.subTopic);\n                else {\n                    this.pendingSubs[obj.subTopic] = true;\n\n                    if (this.pendingUnsubs[obj.subTopic] !== undefined)\n                        delete this.pendingUnsubs[obj.subTopic];\n\n                        doConnect = true;\n                    }\n                }\n            }\n                \n            if (obj.matchInterface('Actuator') !== undefined) {\n                var flow = obj.getFlow();\n                \n                obj.pubTopic = obj.getName();\n\n                obj.getFlow = function() {\n                    return flow.concat([\n                        function(message, cb) {\n                            obj.$owner.doSendMessage(obj.pubTopic, message);\n                            cb();\n                        }\n                    ]);\n                };\n\n                if (!this.isConnected) {\n                    doConnect = true;\n                    $thing.agent(obj)('pause')();\n                }\n\n                this.actuatorsTotal++;\n            }\n            \n            if (doConnect)\n                this.doConnect();\n\n        }\n            \n        return obj;\n    },\n\n    removeBehaviour: function() {\n        var self = this,\n            objs = this.$super.apply(this, arguments)\n            ;\n            \n        objs.forEach(function(obj) {\n\n            if (obj.subTopic !== undefined)\n                if (--self.topicRefs[obj.subTopic] <= 0) {\n                    delete self.topicRefs[obj.subTopic];\n\n                    if (self.pendingSubs[obj.subTopic] !== undefined)\n                        delete self.pendingSubs[obj.subTopic];\n\n                    if (self.isConnected)\n                        self.doUnsubscribe(obj.subTopic);\n                    else\n                        self.pendingUnsubs[obj.subTopic] = true;\n                }\n                \n            if (obj.pubTopic !== undefined)\n                self.actuatorsTotal--;\n\n        });\n\n        if (!this.isActive())\n            this.doDisconnect();\n\n        return objs;\n    },\n\n    doConnectWithMqtt: function() {\n        var self = this;\n\n        this.client = mqtt.connect({\n            host: this.host,\n            port: this.port,\n            clientId: this.clientId,\n            reconnectPeriod: this.reconnectPeriod\n        });\n\n        this.client.on('error', function(err) {\n            self.onError(err)();\n        });\n\n        this.client.on('close', function() {\n            self.onDisconnect();\n            self.removeBehaviour(self.broker);\n            delete self.broker;\n        });\n\n        this.client.on('connect', function() {\n            self.broker = self.addBehaviour('@passive', {});\n            self.onConnect();\n        });\n\n        this.client.on('message', function(topic, message) {\n            self.onMessageArrived(\n                topic, \n                $thing.createBuffer(message)\n            );\n        });\n\n    },\n\n    doConnectWithPaho: function() {\n        var self = this;\n\n        this.client = new Paho.MQTT.Client(\n            this.host, \n            this.port, \n            this.clientId\n        );\n\n        this.client.onConnectionLost = function() {\n            self.onDisconnect();\n        };\n                    \n        this.client.onMessageArrived = function(msg) {\n            self.onMessageArrived(\n                msg.destinationName, \n                $thing.createBuffer(msg.payloadBytes)\n            );\n        };\n            \n        this.client.onMessageDelivered = function(msg) {\n            self.onMessageDelivered(\n                msg.destinationName, \n                $thing.createBuffer(msg.payloadBytes)\n            );\n        };\n\n        this.client.connect({\n            onSuccess: function() {\n                self.onConnect();\n            },\n            onFailure: function(err) {\n                self.onError(err);\n            }\n        });\n    },\n\n    isActive: function() {\n        for (var i in this.pendingSubs)\n            break;        \n        for (var j in this.pendingUnsubs)\n            break;\n        for (var k in this.topicRefs)\n            break;\n        if (    i !== undefined || \n                j !== undefined || \n                k !== undefined || \n                this.actuatorsTotal > 0\n        )  \n            return true;\n        else\n            return false;\n    },\n\n    doConnect: function() {\n        if (this.isConnecting) \n            return;\n\n        this.isConnecting = true;\n        this.isConnected = false;\n\n        if ($thing.usePaho)\n            this.doConnectWithPaho();\n        else\n            this.doConnectWithMqtt();\n    },\n\n    doDisconnect: function() {\n        if (this.client !== undefined) {\n\n            this.isConnecting = false;\n            this.isConnected = false;\n\n            if ($thing.usePaho)\n                this.client.disconnect();\n            else\n                this.client.end();\n\n            delete this.client;\n        }\n    },\n\n    doReconnect: function() {\n        if ($thing.usePaho)\n            this.addBehaviour(\n                '@singleton',\n                '@period $', this.reconnectPeriod,\n                'extends Waker', {\n                    wake: function(cb) {\n                        this.$super(cb);\n\n                        if (this.$owner.isConnected)\n                            this.$owner.doDisconnect();\n                        else\n                            this.$owner.doConnect();\n                    }\n                }\n            );\n    },\n\n    doSubscribe: function(topic) {\n        this.client.subscribe(topic);\n    },\n\n    doUnsubscribe: function(topic) {\n        this.client.unsubscribe(topic);\n    },\n\n    doSendMessage: function(topic, message) {\n        var self = this;\n\n        if ($thing.usePaho)\n            this.client.send(topic, message, 0, false);\n        else \n            this.client.publish(\n                topic,\n                message, {\n\n                },\n                function(err) {\n                    if (err) \n                        self.onError(err);\n                    else \n                        self.onMessageDelivered(\n                            topic, \n                            $thing.createBuffer(message)\n                        );\n                }\n            );\n    },\n\n    onError: function(err) {\n        this.isConnecting = false;\n\n        if ($thing.usePaho && err.errorCode === 8)\n            this.onDisconnect();\n    },\n\n    onConnect: function() {\n        this.isConnecting = false;\n        this.isConnected = true;\n\n        for (var i in this.pendingSubs)\n            this.doSubscribe(i);\n\n        for (var j in this.pendingUnsubs)\n            this.doUnsubscribe(j);\n\n        this.pendingSubs = {};\n        this.pendingUnsubs = {};\n\n        for (var k in this.topicRefs)\n            break;\n        if (k === undefined && this.actuatorsTotal <= 0) \n            this.doDisconnect();\n        else\n            this.getChildren().forEach(function(obj) {\n                if (!obj.isAbstract() && \n                    obj.matchInterface('Actuator') !== undefined\n                )       \n                    $thing.agent(obj)('resume')();\n            });\n    },\n\n    onDisconnect: function() {\n        this.isConnecting = false;\n        this.isConnected = false;\n\n        if (this.actuatorsTotal > 0)\n            this.getChildren().forEach(function(obj) {\n                if (obj.matchInterface('Actuator') !== undefined)\n                    $thing.agent(obj)('pause')();\n            });\n\n        if (this.isActive())\n            this.doReconnect();\n    },\n\n    onMessageArrived: function(topic, message) {\n\n        this.getChildren().forEach(function(obj) {\n            if (!obj.isAbstract() && obj.matchInterface(topic) !== undefined)\n                    \n                if (obj.matchInterface('Bridge') !== undefined)\n                    $thing.agent('@select $ not owner:$', topic, obj.$owner.$id)\n                        ('push', message)()\n                        ;\n\n                else if (obj.matchInterface('Sensor') !== undefined)\n                    $thing.agent(obj)\n                        ('push', message)()\n                        ;\n        });\n\n    },\n\n    onMessageDelivered: function(topic, message) {\n\n    }\n\n});"]}